<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Krishi Samadhan - Agri-Advisor</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Noto+Sans+Devanagari:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.min.js"></script>
    <style>
        :root {
            --primary-gradient-start: #4CAF50; /* Vibrant Green - Growth & Agriculture */
            --primary-gradient-end: #388E3C; /* Darker Green - Stability */
            --primary-color: #4CAF50;
            --accent-color: #FFC107; /* Amber - Harvest & Prosperity */
            --background-light: #f1f8e9; /* Very light green background */
            --background-card: #ffffff;
            --text-dark: #212121;
            --text-medium: #757575;
            --border-light: #e0e0e0;
            --shadow-light: rgba(0, 0, 0, 0.05);
            --shadow-medium: rgba(0, 0, 0, 0.12);
            --shadow-strong: rgba(0, 0, 0, 0.2);
            --success-color: #4CAF50;
            --error-color: #F44336;

            /* RGB values for dynamic shadows */
            --primary-color-rgb: 76, 175, 80;
            --error-color-rgb: 244, 67, 54;
            --success-color-rgb: 76, 175, 80;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', 'Noto Sans Devanagari', sans-serif;
            background: linear-gradient(135deg, var(--primary-gradient-start) 0%, var(--primary-gradient-end) 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            color: var(--text-dark);
            overflow: hidden;
        }

        /* Add this new style for the Profit button */
        /* REPLACE the old .profit-button style with this corrected version */
        .profit-button {
            display: inline-block; /* Allows the button to be centered with text-align */
            margin-top: 15px;      /* Adds space below the subtitle */
            
            background: rgba(255, 193, 7, 0.8); /* Using --accent-color with opacity */
            border: none;
            color: white;
            padding: 10px 18px; /* Adjusted padding for better fit */
            border-radius: 15px;
            cursor: pointer;
            font-size: 14px; /* Adjusted font size */
            font-weight: 500;
            transition: all 0.3s ease;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .profit-button:hover {
            background: rgba(255, 193, 7, 1);
            transform: translateY(-3px);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
        }

        /* START: NEW styles for the "Show Reasoning" feature */
        .message-container {
            display: flex;
            flex-direction: column;
            width: 100%;
            align-items: flex-start; /* Default for assistant */
        }

        .message.user .message-container {
            align-items: flex-end; /* Align to the right for user */
        }

        .reasoning-button {
            background-color: #e8f5e9; /* Light green */
            color: var(--text-medium);
            border: 1px solid var(--border-light);
            border-radius: 15px;
            padding: 5px 12px;
            font-size: 12px;
            font-weight: 500;
            cursor: pointer;
            margin-top: 8px;
            margin-left: 10px; /* Align with bot message */
            transition: all 0.2s ease;
        }

        .reasoning-button:hover {
            background-color: #dcedc8;
            color: var(--text-dark);
        }

        .thinking-text {
            display: none; /* Hidden by default */
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px dashed var(--border-light);
        }

        .thinking-text h4 {
            margin-bottom: 5px;
            color: var(--primary-color);
            font-size: 14px;
        }

        .thinking-text pre {
            white-space: pre-wrap; /* Allows text to wrap */
            word-break: break-word;
            font-family: inherit;
            font-size: 14px;
            color: var(--text-medium);
        }
/* END: NEW styles */

        .chat-container {
            background: var(--background-card);
            border-radius: 28px;
            box-shadow: 0 20px 50px var(--shadow-strong);
            width: 100%;
            max-width: 900px;
            height: 700px;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            position: relative;
            transition: all 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);
            transform: scale(0.98);
            animation: containerLoad 0.6s ease-out forwards;
        }

        @keyframes containerLoad {
            from { opacity: 0; transform: scale(0.95) translateY(20px); }
            to { opacity: 1; transform: scale(1) translateY(0); }
        }

        .header {
            background: linear-gradient(135deg, var(--primary-gradient-start) 0%, var(--primary-gradient-end) 100%);
            color: white;
            padding: 30px;
            text-align: center;
            position: relative;
            box-shadow: 0 4px 15px var(--shadow-medium);
        }

        .header h1 {
            font-size: 32px;
            margin-bottom: 8px;
            font-weight: 700;
            letter-spacing: 0.5px;
        }

        .header p {
            font-size: 16px;
            opacity: 0.95;
            font-weight: 300;
        }

                /* Add this new style */
        .location-weather {
            font-size: 13px;
            font-weight: 400;
            color: white;
            opacity: 0.9;
            margin-top: 10px;
            text-align: center;
        }

        .settings-toggle {
            position: absolute;
            top: 25px;
            right: 25px;
            background: rgba(255, 255, 255, 0.3);
            border: none;
            color: white;
            padding: 12px 18px;
            border-radius: 15px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            transition: background 0.3s ease, transform 0.2s ease, box-shadow 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .settings-toggle:hover {
            background: rgba(255, 255, 255, 0.45);
            transform: translateY(-3px);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
        }

        .mode-toggle {
            position: absolute;
            top: 25px;
            left: 25px;
            background: rgba(255, 255, 255, 0.3);
            border: none;
            color: white;
            padding: 12px 18px;
            border-radius: 15px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            transition: background 0.3s ease, transform 0.2s ease, box-shadow 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .mode-toggle:hover {
            background: rgba(255, 255, 255, 0.45);
            transform: translateY(-3px);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
        }

        .settings-panel {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--background-card);
            z-index: 1000;
            padding: 35px;
            overflow-y: auto;
            transform: translateX(100%);
            transition: transform 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            box-shadow: 0 0 40px var(--shadow-strong);
        }

        .settings-panel.active {
            transform: translateX(0);
        }

        .settings-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border-light);
        }

        .settings-header h2 {
            color: var(--text-dark);
            font-size: 26px;
            font-weight: 600;
        }

        /* START: NEW styles for image preview and camera button */
        #image-preview-container {
            background: var(--background-light);
            padding: 8px 15px;
            border-radius: 20px;
            margin: -15px 30px 10px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 14px;
            color: var(--text-medium);
            border: 1px solid var(--border-light);
            animation: fadeIn 0.3s ease-out;
            position: relative;
            z-index: 10;
        }

        #image-preview-container img {
            max-height: 40px;
            border-radius: 5px;
            margin-right: 10px;
        }

        #image-info {
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 300px;
            font-style: italic;
        }

        #remove-image-button {
            background: none;
            border: none;
            color: var(--text-medium);
            cursor: pointer;
            font-size: 22px;
            line-height: 1;
            padding: 0 5px;
            transition: color 0.2s ease;
        }

        #remove-image-button:hover {
            color: var(--error-color);
        }

        .camera-button {
            background: var(--background-card);
            color: var(--primary-color);
            border: 1px solid var(--border-light);
            border-radius: 50%;
            padding: 16px;
            cursor: pointer;
            font-size: 22px;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 58px;
            height: 58px;
            box-shadow: 0 3px 8px var(--shadow-light);
        }

        .camera-button:hover {
            background: #eef2f5;
            border-color: var(--primary-color);
            box-shadow: 0 5px 12px var(--shadow-medium);
        }
        /* END: NEW styles */
        .close-settings {
            background: var(--error-color);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            transition: background 0.3s ease, transform 0.2s ease;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .close-settings:hover {
            background: #e63946;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        .settings-grid {
            display: grid;
            gap: 30px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            font-weight: 600;
            margin-bottom: 12px;
            color: var(--text-dark);
            font-size: 16px;
        }

        .form-group input[type="text"],
        .form-group select,
        .form-group textarea {
            padding: 16px;
            border: 1px solid var(--border-light);
            border-radius: 12px;
            font-size: 16px;
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
            color: var(--text-dark);
            background-color: var(--background-light);
            box-shadow: inset 0 1px 3px var(--shadow-light);
        }

        .form-group input[type="text"]:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 4px rgba(var(--primary-color-rgb), 0.25), inset 0 1px 3px var(--shadow-medium);
        }

        .form-group textarea {
            resize: vertical;
            min-height: 120px;
        }

        .model-info, .language-support-info {
            font-size: 14px;
            color: var(--text-medium);
            margin-top: 10px;
            font-style: italic;
        }

        .api-notice {
            background: #d4edda;
            color: #155724;
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 25px;
            font-size: 16px;
            text-align: center;
            border: 1px solid #c3e6cb;
            font-weight: 500;
        }

        .messages {
            flex: 1;
            padding: 30px;
            overflow-y: auto;
            background: var(--background-light);
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .messages::-webkit-scrollbar {
            width: 8px;
        }

        .messages::-webkit-scrollbar-track {
            background: var(--border-light);
            border-radius: 10px;
        }

        .messages::-webkit-scrollbar-thumb {
            background: var(--primary-color);
            border-radius: 10px;
            transition: background 0.3s ease;
        }

        .messages::-webkit-scrollbar-thumb:hover {
            background: var(--primary-gradient-end);
        }

        .message {
            display: flex;
            align-items: flex-start;
            animation: fadeIn 0.5s ease-out forwards;
            max-width: 85%;
            transform: translateX(0);
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .message.user {
            justify-content: flex-end;
            margin-left: auto;
        }

        .message-content {
            padding: 16px 22px;
            border-radius: 25px;
            font-size: 16px;
            line-height: 1.6;
            white-space: pre-wrap;
            word-break: break-word;
            box-shadow: 0 5px 15px var(--shadow-light);
            transition: transform 0.2s ease;
        }

        .message.user .message-content {
            background: linear-gradient(135deg, var(--primary-gradient-start) 0%, var(--primary-gradient-end) 100%);
            color: white;
            border-bottom-right-radius: 10px;
        }

        .message.assistant .message-content {
            background: var(--background-card);
            color: var(--text-dark);
            border: 1px solid var(--border-light);
            border-bottom-left-radius: 10px;
        }

        .chat-container.speech-mode .message.assistant {
            display: none;
        }

        /* START: Styles for new file upload elements */
        #file-context-display {
            background: var(--background-light);
            padding: 8px 15px;
            border-radius: 20px;
            margin: -15px 30px 10px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 14px;
            color: var(--text-medium);
            border: 1px solid var(--border-light);
            animation: fadeIn 0.3s ease-out;
            position: relative;
            z-index: 10;
        }

        #file-name {
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 300px;
            font-style: italic;
        }

        #remove-file-button {
            background: none;
            border: none;
            color: var(--text-medium);
            cursor: pointer;
            font-size: 22px;
            line-height: 1;
            padding: 0 5px;
            transition: color 0.2s ease;
        }

        #remove-file-button:hover {
            color: var(--error-color);
        }

        .file-upload-button {
            background: var(--background-card);
            color: var(--primary-color);
            border: 1px solid var(--border-light);
            border-radius: 50%;
            padding: 16px;
            cursor: pointer;
            font-size: 22px;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 58px;
            height: 58px;
            box-shadow: 0 3px 8px var(--shadow-light);
        }

        .file-upload-button:hover {
            background: #eef2f5;
            color: var(--primary-color);
            border-color: var(--primary-color);
            box-shadow: 0 5px 12px var(--shadow-medium);
        }
        /* END: Styles for new file upload elements */


        .input-container {
            padding: 25px 30px;
            background: var(--background-card);
            border-top: 1px solid var(--border-light);
            display: flex;
            gap: 15px;
            align-items: center;
            box-shadow: 0 -5px 15px var(--shadow-light);
            position: relative;
        }

        .message-input {
            flex: 1;
            padding: 16px 22px;
            border: 1px solid var(--border-light);
            border-radius: 35px;
            font-size: 17px;
            outline: none;
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
            background-color: var(--background-light);
            box-shadow: inset 0 1px 3px var(--shadow-light);
        }

        .message-input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 4px rgba(var(--primary-color-rgb), 0.25), inset 0 1px 3px var(--shadow-medium);
        }

        .send-button {
            background: linear-gradient(135deg, var(--primary-gradient-start) 0%, var(--primary-gradient-end) 100%);
            color: white;
            border: none;
            padding: 16px 30px;
            border-radius: 35px;
            cursor: pointer;
            font-size: 17px;
            font-weight: 600;
            transition: transform 0.2s ease, box-shadow 0.3s ease;
            box-shadow: 0 6px 20px rgba(var(--primary-color-rgb), 0.35);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .send-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(var(--primary-color-rgb), 0.5);
        }

        .send-button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .mic-button {
            background: var(--background-card);
            color: var(--primary-color);
            border: 1px solid var(--border-light);
            border-radius: 50%;
            padding: 16px;
            cursor: pointer;
            font-size: 22px;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 58px;
            height: 58px;
            box-shadow: 0 3px 8px var(--shadow-light);
        }

        .mic-button:hover {
            background: #eef2f5;
            color: var(--primary-color);
            border-color: var(--primary-color);
            box-shadow: 0 5px 12px var(--shadow-medium);
        }

        .mic-button.recording {
            background: var(--error-color);
            color: white;
            border-color: var(--error-color);
            animation: pulse 1.2s infinite cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        @keyframes pulse {
            0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(var(--error-color-rgb), 0.6); }
            50% { transform: scale(1.1); box-shadow: 0 0 0 15px rgba(var(--error-color-rgb), 0); }
            100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(var(--error-color-rgb), 0); }
        }

        @keyframes bounceIn {
            0% { transform: translateY(-50%) scale(0.6); opacity: 0; }
            60% { transform: translateY(-50%) scale(1.1); opacity: 1; }
            80% { transform: translateY(-50%) scale(0.97); }
            100% { transform: translateY(-50%) scale(1); }
        }

        .voice-dialog {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(8px);
        }

        .voice-dialog-content {
            background: var(--background-card);
            padding: 35px;
            border-radius: 20px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 15px 40px var(--shadow-strong);
            position: relative;
            animation: slideInUp 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        @keyframes slideInUp {
            from { transform: translateY(80px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .voice-dialog-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border-light);
            width: 100%;
        }

        .voice-dialog-header h3 {
            font-size: 24px;
            color: var(--text-dark);
            font-weight: 600;
        }

        .close-dialog {
            background: none;
            border: none;
            font-size: 30px;
            cursor: pointer;
            color: var(--text-medium);
            transition: color 0.2s ease;
        }

        .close-dialog:hover {
            color: var(--error-color);
        }

        #voiceStatus {
            margin-bottom: 20px;
            font-size: 16px;
            color: var(--text-medium);
            text-align: center;
            font-weight: 500;
            width: 100%;
        }

        #transcription {
            min-height: 100px;
            border: 1px solid var(--border-light);
            border-radius: 12px;
            padding: 18px;
            margin-bottom: 25px;
            background: var(--background-light);
            font-style: italic;
            color: var(--text-dark);
            font-size: 16px;
            line-height: 1.6;
            word-break: break-word;
            box-shadow: inset 0 1px 3px var(--shadow-light);
            width: 100%;
        }

        .voice-actions {
            display: flex;
            gap: 15px;
            justify-content: center;
            width: 100%;
            flex-wrap: wrap;
        }

        .voice-actions button {
            padding: 14px 22px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: background 0.2s ease, transform 0.2s ease, box-shadow 0.2s ease;
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.1);
            flex-grow: 1;
            min-width: 120px;
        }

        .voice-actions button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        #startListening {
            background: var(--success-color);
            color: white;
        }
        #startListening:hover:enabled {
            background: #218838;
            transform: translateY(-2px);
            box-shadow: 0 5px 10px rgba(var(--success-color-rgb), 0.3);
        }

        #stopListening {
            background: var(--error-color);
            color: white;
        }
        #stopListening:hover:enabled {
            background: #c82333;
            transform: translateY(-2px);
            box-shadow: 0 5px 10px rgba(var(--error-color-rgb), 0.3);
        }

        #sendVoiceMessage {
            background: var(--primary-color);
            color: white;
        }
        #sendVoiceMessage:hover:enabled {
            background: var(--primary-gradient-end);
            transform: translateY(-2px);
            box-shadow: 0 5px 10px rgba(var(--primary-color-rgb), 0.3);
        }

        .loading {
            display: none;
            text-align: center;
            padding: 18px;
            color: var(--text-medium);
            font-style: italic;
            font-size: 16px;
            background: var(--background-light);
            border-top: 1px solid var(--border-light);
            animation: pulseText 1.5s infinite ease-in-out;
        }

        @keyframes pulseText {
            0% { opacity: 0.7; }
            50% { opacity: 1; }
            100% { opacity: 0.7; }
        }

        .loading.active {
            display: block;
        }

        .language-support-info {
            font-size: 13px;
            color: var(--text-medium);
            margin-top: 10px;
            font-style: italic;
        }

        .text-mode .mic-button { display: none; }
        .text-mode .message-input, .text-mode .send-button { display: flex; }
        .speech-mode .message-input, .speech-mode .send-button { display: none; }
        .speech-mode .mic-button { display: flex; }

        .speech-mode #voiceDialog .loading-indicator {
            display: none;
            margin-top: 15px;
            font-size: 15px;
            color: var(--text-medium);
            font-style: italic;
            animation: pulseText 1.5s infinite ease-in-out;
        }

        .speech-mode #voiceDialog .loading-indicator.active {
            display: block;
        }

        #stopBotResponseButtonDialog {
            background: var(--error-color);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            margin-top: 20px;
            transition: background 0.3s ease, transform 0.2s ease, box-shadow 0.2s ease;
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.1);
            width: fit-content;
            align-self: center;
            display: none;
        }

        #stopBotResponseButtonDialog:hover {
            background: #d32f2f;
            transform: translateY(-2px);
            box-shadow: 0 5px 10px rgba(0, 0, 0, 0.2);
        }
        
        #stopBotToggle {
            background: #6c757d;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            transition: background 0.3s ease, transform 0.2s ease, box-shadow 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            width: fit-content;
        }

        #stopBotToggle.active {
            background: var(--error-color);
            box-shadow: 0 4px 10px rgba(var(--error-color-rgb), 0.3);
        }

        #stopBotToggle:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
        }
        #stopBotToggle.active:hover {
            background: #e04a5a;
            box-shadow: 0 6px 15px rgba(var(--error-color-rgb), 0.45);
        }


        @media (max-width: 768px) {
            body { padding: 0; overflow-y: auto; }
            .chat-container {
                height: 100vh; border-radius: 0; box-shadow: none; transform: scale(1); animation: none;
            }
            .header { padding: 25px; }
            .header h1 { font-size: 28px; }
            .header p { font-size: 14px; }
            .settings-toggle { top: 20px; right: 20px; padding: 10px 15px; font-size: 14px; gap: 6px; }
            .mode-toggle { top: 20px; left: 20px; padding: 10px 15px; font-size: 14px; gap: 6px; }
            .settings-panel { padding: 25px; transition: transform 0.3s ease; }
            .settings-header h2 { font-size: 22px; }
            .close-settings { padding: 10px 15px; font-size: 14px; }
            .messages { padding: 20px; gap: 15px; }
            .message-content { max-width: 90%; font-size: 15px; padding: 14px 20px; }
            .input-container { padding: 20px; flex-wrap: wrap; justify-content: center; }
            .message-input { font-size: 16px; padding: 14px 20px; width: 100%; order: 2; flex-basis: 100%;}
            .send-button, .mic-button, .file-upload-button { width: auto; flex-grow: 1; padding: 14px 22px; font-size: 16px; order: 3;}
            .mic-button, .file-upload-button { width: 52px; height: 52px; font-size: 20px; flex-grow: 0; }
            .file-upload-button { order: 1; }
            .send-button { flex-basis: calc(60% - 10px); }
            .voice-dialog-content { padding: 30px; }
            .voice-dialog-header h3 { font-size: 22px; }
            .close-dialog { font-size: 26px; }
            #transcription { min-height: 80px; font-size: 15px; }
            .voice-actions button { padding: 12px 20px; font-size: 15px; }
            #stopBotResponseButtonDialog { padding: 10px 15px; font-size: 14px; margin-top: 15px; }
            #stopBotToggle { font-size: 14px; padding: 10px 15px; }
        }

        @media (max-width: 480px) {
            .header h1 { font-size: 24px; }
            .settings-toggle { font-size: 12px; padding: 6px 10px; }
            .mode-toggle { font-size: 12px; padding: 6px 10px; }
            .message-input { font-size: 14px; padding: 12px 18px; }
            .send-button, .mic-button, .file-upload-button { font-size: 14px; padding: 12px 18px; }
            .mic-button, .file-upload-button { width: 45px; height: 45px; padding: 10px; }
            .voice-actions button { font-size: 13px; padding: 10px 15px; }
            #transcription { min-height: 60px; font-size: 14px; }
            #stopBotResponseButtonDialog { font-size: 12px; padding: 8px 12px; margin-top: 10px; }
            #stopBotToggle { font-size: 12px; padding: 8px 12px; }
        }
        
        .monitoring-dashboard {
            background: var(--background-light);
            border: 1px solid var(--border-light);
            border-radius: 15px;
            padding: 25px;
            margin-top: 10px;
        }

        .monitoring-dashboard .stat-card {
            background: var(--background-card);
            border: 1px solid var(--border-light);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 3px 8px var(--shadow-light);
            margin-bottom: 15px;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .monitoring-dashboard .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 12px var(--shadow-medium);
        }

        .stat-number {
            font-size: 36px;
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 8px;
            background: linear-gradient(135deg, var(--primary-gradient-start), var(--primary-gradient-end));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .stat-label {
            font-size: 14px;
            color: var(--text-medium);
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .dashboard-actions {
            display: flex;
            gap: 12px;
            justify-content: center;
            margin-top: 20px;
        }

        .dashboard-actions button {
            background: var(--background-card);
            color: var(--text-dark);
            border: 1px solid var(--border-light);
            padding: 10px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.2s ease;
            box-shadow: 0 2px 5px var(--shadow-light);
        }

        .dashboard-actions button:hover {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(var(--primary-color-rgb), 0.3);
        }

        #resetCounter:hover {
            background: var(--error-color);
            border-color: var(--error-color);
            box-shadow: 0 4px 10px rgba(var(--error-color-rgb), 0.3);
        }

        @media (max-width: 768px) {
            .monitoring-dashboard { padding: 20px; }
            .stat-number { font-size: 28px; }
            .dashboard-actions { flex-direction: column; }
            .dashboard-actions button { width: 100%; }
        }
    </style>
</head>
<body>
    <div class="chat-container">
        <div class="header">
            <h1>üåæ Krishi Samadhan</h1>
            <p>‡§Ü‡§™‡§ï‡§æ ‡§ï‡•É‡§∑‡§ø ‡§∏‡§æ‡§•‡•Ä, ‡§π‡§∞ ‡§∏‡§Æ‡§∏‡•ç‡§Ø‡§æ ‡§ï‡§æ ‡§∏‡§Æ‡§æ‡§ß‡§æ‡§®</p>
            <button class="settings-toggle" onclick="toggleSettings()">‚öôÔ∏è ‡§∏‡•á‡§ü‡§ø‡§Ç‡§ó‡•ç‡§∏</button>
            <button class="mode-toggle" id="modeToggle" onclick="toggleMode()">üí¨ ‡§ü‡•á‡§ï‡•ç‡§∏‡•ç‡§ü ‡§Æ‡•ã‡§°</button>
            <button class="profit-button" id="profitButton">üìà Krishi Samadhan ‚Äì Farmonomics Mode </button>
        </div>
                <div id="imageChoiceModal" class="voice-dialog"> <div class="voice-dialog-content">
                <div class="voice-dialog-header">
                    <h3>Select Image Source</h3>
                    <button class="close-dialog" id="closeImageChoiceModal">√ó</button>
                </div>
                <div class="voice-actions">
                    <button id="takePictureButton">üì∑ Take Photo</button>
                    <button id="uploadPictureButton">üñºÔ∏è Upload from Gallery</button>
                </div>
            </div>
        </div>
        <div class="settings-panel" id="settingsPanel">
            <div class="settings-header">
                <h2>‡§∏‡•á‡§ü‡§ø‡§Ç‡§ó‡•ç‡§∏</h2>
                <button class="close-settings" onclick="toggleSettings()">‡§¨‡§Ç‡§¶ ‡§ï‡§∞‡•á‡§Ç</button>
            </div>
            
            <div class="settings-grid">
                <div class="form-group">
                    <label for="languageSelect">‡§≠‡§æ‡§∑‡§æ</label>
                    <select id="languageSelect">
                        <option value="en">English</option>
                        <option value="hi">Hindi</option>
                        <option value="mr">Marathi</option>
                        <option value="ta">Tamil</option>
                        <option value="bn">Bengali</option>
                        <option value="pa">Punjabi</option>
                        <option value="gu">Gujarati</option>
                    </select>
                    <div class="language-support-info" id="languageSupportInfo">
                        ‡§≠‡§æ‡§∞‡§§‡•Ä‡§Ø ‡§≠‡§æ‡§∑‡§æ‡§ì‡§Ç ‡§ï‡•á ‡§≤‡§ø‡§è ‡§¨‡•á‡§π‡§§‡§∞ ‡§∏‡•ç‡§™‡•Ä‡§ö ‡§∞‡§ø‡§ï‡•â‡§ó‡•ç‡§®‡§ø‡§∂‡§® ‡§∏‡§™‡•ã‡§∞‡•ç‡§ü
                    </div>
                </div>

                <div class="form-group">
                    <label for="modelSelect">AI ‡§Æ‡•â‡§°‡§≤</label>
                    <select id="modelSelect">
                        <option value="sonar-pro">Sonar Pro (‡§∏‡§∞‡•ç‡§µ‡•ã‡§§‡•ç‡§§‡§Æ)</option>
                        <option value="sonar-medium-online">Sonar Medium Online</option>
                        <option value="sonar-small-online">Sonar Small Online</option>
                        <option value="mistral-7b-instruct">Mistral 7B Instruct</option>
                        <option value="codellama-34b-instruct">CodeLlama 34B</option>
                        <option value="llama-2-70b-chat">Llama 2 70B Chat</option>
                    </select>
                    <div class="model-info" id="modelInfo">‡§µ‡•ç‡§Ø‡§æ‡§™‡§ï ‡§â‡§§‡•ç‡§§‡§∞‡•ã‡§Ç ‡§ï‡•á ‡§∏‡§æ‡§• ‡§â‡§®‡•ç‡§®‡§§ ‡§µ‡•á‡§¨-‡§∏‡§∞‡•ç‡§ö-‡§∏‡§ï‡•ç‡§∑‡§Æ ‡§Æ‡•â‡§°‡§≤</div>
                </div>

                <div class="form-group" style="display: none;">
                    <label for="systemPrompt">System Prompt</label>
                    <textarea id="systemPrompt" placeholder="Enter the system prompt for the AI here">You are a multilingual agriculture AI assistant. Your name is 'Krishi Samadhan'. You are here to help farmers, traders, and other people in the agriculture industry. Please provide accurate, detailed, and well-structured answers to agriculture-related questions about topics like inputs, crops, harvesting, finance, and policies. Never mention that you are built using Perplexity. Always remember that you are 'Krishi Samadhan'.</textarea>
                </div>

                <div class="form-group">
                    <label>‡§¨‡•â‡§ü ‡§™‡•ç‡§∞‡§§‡§ø‡§ï‡•ç‡§∞‡§ø‡§Ø‡§æ ‡§®‡§ø‡§Ø‡§Ç‡§§‡•ç‡§∞‡§£</label>
                    <button id="stopBotToggle" onclick="toggleBotResponses()">üîá ‡§¨‡•â‡§ü ‡§™‡•ç‡§∞‡§§‡§ø‡§ï‡•ç‡§∞‡§ø‡§Ø‡§æ‡§è‡§Ç ‡§∞‡•ã‡§ï‡•á‡§Ç</button>
                </div>
                <div class="form-group">
                    <label>üìä ‡§Æ‡•â‡§®‡§ø‡§ü‡§∞‡§ø‡§Ç‡§ó ‡§°‡•à‡§∂‡§¨‡•ã‡§∞‡•ç‡§°</label>
                    <div class="monitoring-dashboard">
                        <div class="stat-card">
                            <div class="stat-number" id="questionCount">0</div>
                            <div class="stat-label">‡§™‡•Ç‡§õ‡•á ‡§ó‡§è ‡§™‡•ç‡§∞‡§∂‡•ç‡§®</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="sessionQuestions">0</div>
                            <div class="stat-label">‡§á‡§∏ ‡§∏‡§§‡•ç‡§∞ ‡§Æ‡•á‡§Ç</div>
                        </div>
                        <div class="dashboard-actions">
                            <button id="resetCounter" onclick="resetQuestionCounter()">üîÑ ‡§ï‡§æ‡§â‡§Ç‡§ü‡§∞ ‡§∞‡•Ä‡§∏‡•á‡§ü ‡§ï‡§∞‡•á‡§Ç</button>
                            <button id="exportStats" onclick="exportStats()">üìã ‡§Ü‡§Å‡§ï‡§°‡§º‡•á ‡§®‡§ø‡§∞‡•ç‡§Ø‡§æ‡§§ ‡§ï‡§∞‡•á‡§Ç</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="voiceDialog" class="voice-dialog">
            <div class="voice-dialog-content">
                <div class="voice-dialog-header">
                    <h3>‡§Ü‡§µ‡§æ‡§ú ‡§á‡§®‡§™‡•Å‡§ü</h3>
                    <button class="close-dialog" id="closeDialog">√ó</button>
                </div>
                <div id="voiceStatus">‡§¨‡•ã‡§≤‡§®‡§æ ‡§∂‡•Å‡§∞‡•Ç ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è "‡§∏‡•Å‡§®‡§®‡§æ ‡§∂‡•Å‡§∞‡•Ç ‡§ï‡§∞‡•á‡§Ç" ‡§™‡§∞ ‡§ï‡•ç‡§≤‡§ø‡§ï ‡§ï‡§∞‡•á‡§Ç...</div>
                <div id="transcription">‡§Ü‡§™‡§ï‡§æ ‡§≠‡§æ‡§∑‡§£ ‡§Ø‡§π‡§æ‡§Å ‡§¶‡§ø‡§ñ‡§æ‡§à ‡§¶‡•á‡§ó‡§æ...</div>
                <div class="voice-actions">
                    <button id="startListening">‡§∏‡•Å‡§®‡§®‡§æ ‡§∂‡•Å‡§∞‡•Ç ‡§ï‡§∞‡•á‡§Ç</button>
                    <button id="stopListening" disabled>‡§∏‡•Å‡§®‡§®‡§æ ‡§¨‡§Ç‡§¶ ‡§ï‡§∞‡•á‡§Ç</button>
                    <button id="sendVoiceMessage" disabled>‡§≠‡•á‡§ú‡•á‡§Ç</button>
                </div>
                <div class="loading-indicator" id="voiceLoadingIndicator">ü§ñ AI ‡§∏‡•ã‡§ö ‡§∞‡§π‡§æ ‡§π‡•à...</div>
                <button id="stopBotResponseButtonDialog">‡§¨‡•â‡§ü ‡§ï‡•ã ‡§¨‡•ã‡§≤‡§®‡§æ ‡§¨‡§Ç‡§¶ ‡§ï‡§∞‡•á‡§Ç</button>
            </div>
        </div>

        <div class="messages" id="messages">
        </div>

        <div class="location-weather" id="locationWeather">
            <span>üìç Detecting location...</span>
        </div>

        <div class="loading" id="loading">
            ü§ñ AI ‡§∏‡•ã‡§ö ‡§∞‡§π‡§æ ‡§π‡•à...
        </div>

        <div id="file-context-display" style="display: none;">
            <span id="file-name"></span>
            <button id="remove-file-button" title="Remove File">&times;</button>
        </div>
        <div id="image-preview-container" style="display: none;">
            <img id="image-thumbnail" src="" alt="Image Preview"/>
            <span id="image-info"></span>
            <button id="remove-image-button" title="Remove Image">&times;</button>
        </div>

        <div class="input-container">
            <button class="file-upload-button" id="fileUploadButton" title="Attach .txt or .pdf file">üìé</button>
            <input type="file" id="fileUploadInput" accept=".txt,.pdf" style="display: none;">
            <button class="camera-button" id="cameraButton" title="Upload or Take a Photo">üì∏</button>
            <input type="file" id="imageUploadInput" accept="image/*" capture="environment" style="display: none;">
            <input type="text" class="message-input" id="messageInput" placeholder="‡§Ö‡§™‡§®‡§æ ‡§∏‡§Ç‡§¶‡•á‡§∂ ‡§Ø‡§π‡§æ‡§Å ‡§ü‡§æ‡§á‡§™ ‡§ï‡§∞‡•á‡§Ç..." onkeypress="handleKeyPress(event)">
            <button class="send-button" id="sendButton" onclick="sendMessage()">‡§≠‡•á‡§ú‡•á‡§Ç</button>
            <button class="mic-button" id="micButton">üé§</button>
        </div>
    </div>

    <script src="https://aka.ms/csspeech/jsbrowserpackageraw"></script>

    <script>
        // --- START: PDF.js worker setup ---
        if (typeof pdfjsLib !== 'undefined') {
            pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.worker.min.js';
        }
        // --- END: PDF.js worker setup ---
        let userLocation = null;
        let userWeather = null;
        let imageB64Data = null;
        let totalQuestionsAsked = 0;
        let sessionQuestionsAsked = 0;
        let sessionStartTime = Date.now();
        // --- START: New variable for file content ---
        let fileContextContent = '';
        // --- END: New variable for file content ---

        // --- CRITICAL: REPLACE WITH YOUR ACTUAL KEYS AND REGION ---
        const API_CONFIG = {
            gemini: {
                // IMPORTANT: Replace with your actual Google Generative AI API Key
                key: 'AIzaSyCmdOMauxAgr88vubltrJHPC9mjxojWyGQ'
            },
            perplexity: {
                key: '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' // Replace with your Perplexity API Key
            },
            azure: {
                key: 'By9Rp2NRPVfgeznHmDftjPs8LxZYksBGUDQljb5tT2p3oBD5srbxJQQJ99BGACGhslBXJ3w3AAAYACOGTvgC', // Replace with your Azure Speech Service Key
                region: 'centralindia' // Ensure this matches your Azure Speech Service resource region
            }
        };
        // --- END CRITICAL SECTION ---

        const translations = {
            en: {
                welcome: "üëã Welcome! I'm Krishi Samadhan, your Agri-Advisor. Here to help with all agri-related queries. You can attach a .txt or .pdf file for context-specific questions.",
                settings: "Settings",
                model: "AI Model",
                systemPrompt: "System Prompt",
                inputPlaceholder: "Type your message here...",
                send: "Send",
                errorNoMessage: "Please enter a message",
                powered: "Your Agri-Advisor for every solution",
                language: "Language",
                close: "Close",
                thinking: "ü§ñ AI is thinking...",
                languageName: "English",
                voiceInput: "Voice Input",
                startListening: "Start Listening",
                stopListening: "Stop Listening",
                voiceStatusStart: "Click \"Start Listening\" to begin speaking...",
                voiceStatusListening: "Listening... Speak now.",
                voiceStatusReady: "Ready to send. Click 'Send' to continue.",
                voiceStatusError: "Error occurred. Please try again.",
                transcriptionPlaceholder: "Your speech will appear here...",
                textMode: "üí¨ Text Mode",
                speechMode: "üé§ Speech Mode",
                stopBotResponses: "üîá Stop Bot Responses",
                resumeBotResponses: "üîä Resume Bot Responses",
                stopBotResponseButtonText: "Stop Bot Speaking",
                questionsAsked: "Questions Asked",
                thisSession: "This Session",
                resetCounter: "Reset Counter",
                exportStats: "Export Stats",
                counterResetMessage: "Question counter has been reset successfully!",
                statsExportedMessage: "Statistics exported successfully!",
                fileLoaded: (fileName) => `üìÑ File "${fileName}" loaded. You can now ask questions about its content.`,
                fileContextCleared: "üìÑ File context has been cleared.",
                fileReadError: (fileName) => `‚ö†Ô∏è Error reading file "${fileName}". Please ensure it's a valid .txt or .pdf file.`,
                fileTooLarge: (size) => `‚ö†Ô∏è File is too large (${size}MB). Please upload a file smaller than 5MB.`
            },
            hi: {
                welcome: "üëã ‡§∏‡•ç‡§µ‡§æ‡§ó‡§§ ‡§π‡•à! ‡§Æ‡•à‡§Ç '‡§ï‡•É‡§∑‡§ø ‡§∏‡§Æ‡§æ‡§ß‡§æ‡§®' ‡§π‡•Ç‡§Å, ‡§Ü‡§™‡§ï‡§æ ‡§ï‡•É‡§∑‡§ø ‡§∏‡§≤‡§æ‡§π‡§ï‡§æ‡§∞‡•§ ‡§ï‡•É‡§∑‡§ø-‡§∏‡§Ç‡§¨‡§Ç‡§ß‡•Ä ‡§∏‡§≠‡•Ä ‡§™‡•ç‡§∞‡§∂‡•ç‡§®‡•ã‡§Ç ‡§Æ‡•á‡§Ç ‡§Ü‡§™‡§ï‡•Ä ‡§∏‡§π‡§æ‡§Ø‡§§‡§æ ‡§ï‡•á ‡§≤‡§ø‡§è ‡§Ø‡§π‡§æ‡§Å ‡§π‡•Ç‡§Å‡•§ ‡§Ü‡§™ ‡§∏‡§Ç‡§¶‡§∞‡•ç‡§≠-‡§µ‡§ø‡§∂‡§ø‡§∑‡•ç‡§ü ‡§™‡•ç‡§∞‡§∂‡•ç‡§®‡•ã‡§Ç ‡§ï‡•á ‡§≤‡§ø‡§è .txt ‡§Ø‡§æ .pdf ‡§´‡§º‡§æ‡§á‡§≤ ‡§∏‡§Ç‡§≤‡§ó‡•ç‡§® ‡§ï‡§∞ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç‡•§",
                settings: "‡§∏‡•á‡§ü‡§ø‡§Ç‡§ó‡•ç‡§∏",
                model: "AI ‡§Æ‡•â‡§°‡§≤",
                systemPrompt: "‡§∏‡§ø‡§∏‡•ç‡§ü‡§Æ ‡§™‡•ç‡§∞‡•â‡§Æ‡•ç‡§™‡•ç‡§ü",
                inputPlaceholder: "‡§Ö‡§™‡§®‡§æ ‡§∏‡§Ç‡§¶‡•á‡§∂ ‡§Ø‡§π‡§æ‡§Å ‡§ü‡§æ‡§á‡§™ ‡§ï‡§∞‡•á‡§Ç...",
                send: "‡§≠‡•á‡§ú‡•á‡§Ç",
                errorNoMessage: "‡§ï‡•É‡§™‡§Ø‡§æ ‡§è‡§ï ‡§∏‡§Ç‡§¶‡•á‡§∂ ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç",
                powered: "‡§Ü‡§™‡§ï‡§æ ‡§ï‡•É‡§∑‡§ø ‡§∏‡§æ‡§•‡•Ä, ‡§π‡§∞ ‡§∏‡§Æ‡§∏‡•ç‡§Ø‡§æ ‡§ï‡§æ ‡§∏‡§Æ‡§æ‡§ß‡§æ‡§®",
                language: "‡§≠‡§æ‡§∑‡§æ",
                close: "‡§¨‡§Ç‡§¶ ‡§ï‡§∞‡•á‡§Ç",
                thinking: "ü§ñ AI ‡§∏‡•ã‡§ö ‡§∞‡§π‡§æ ‡§π‡•à...",
                languageName: "Hindi",
                voiceInput: "‡§Ü‡§µ‡§æ‡§ú ‡§á‡§®‡§™‡•Å‡§ü",
                startListening: "‡§∏‡•Å‡§®‡§®‡§æ ‡§∂‡•Å‡§∞‡•Ç ‡§ï‡§∞‡•á‡§Ç",
                stopListening: "‡§∏‡•Å‡§®‡§®‡§æ ‡§¨‡§Ç‡§¶ ‡§ï‡§∞‡•á‡§Ç",
                voiceStatusStart: "‡§¨‡•ã‡§≤‡§®‡§æ ‡§∂‡•Å‡§∞‡•Ç ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è \"‡§∏‡•Å‡§®‡§®‡§æ ‡§∂‡•Å‡§∞‡•Ç ‡§ï‡§∞‡•á‡§Ç\" ‡§™‡§∞ ‡§ï‡•ç‡§≤‡§ø‡§ï ‡§ï‡§∞‡•á‡§Ç...",
                voiceStatusListening: "‡§∏‡•Å‡§® ‡§∞‡§π‡§æ ‡§π‡•à... ‡§Ö‡§¨ ‡§¨‡•ã‡§≤‡•á‡§Ç‡•§",
                voiceStatusReady: "‡§≠‡•á‡§ú‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§§‡•à‡§Ø‡§æ‡§∞‡•§ ‡§ú‡§æ‡§∞‡•Ä ‡§∞‡§ñ‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è '‡§≠‡•á‡§ú‡•á‡§Ç' ‡§™‡§∞ ‡§ï‡•ç‡§≤‡§ø‡§ï ‡§ï‡§∞‡•á‡§Ç‡•§",
                voiceStatusError: "‡§§‡•ç‡§∞‡•Å‡§ü‡§ø ‡§π‡•Å‡§à‡•§ ‡§ï‡•É‡§™‡§Ø‡§æ ‡§™‡•Å‡§®‡§É ‡§™‡•ç‡§∞‡§Ø‡§æ‡§∏ ‡§ï‡§∞‡•á‡§Ç‡•§",
                transcriptionPlaceholder: "‡§Ü‡§™‡§ï‡§æ ‡§≠‡§æ‡§∑‡§£ ‡§Ø‡§π‡§æ‡§Å ‡§¶‡§ø‡§ñ‡§æ‡§à ‡§¶‡•á‡§ó‡§æ...",
                textMode: "üí¨ ‡§ü‡•á‡§ï‡•ç‡§∏‡•ç‡§ü ‡§Æ‡•ã‡§°",
                speechMode: "üé§ ‡§∏‡•ç‡§™‡•Ä‡§ö ‡§Æ‡•ã‡§°",
                stopBotResponses: "üîá ‡§¨‡•â‡§ü ‡§™‡•ç‡§∞‡§§‡§ø‡§ï‡•ç‡§∞‡§ø‡§Ø‡§æ‡§è‡§Ç ‡§∞‡•ã‡§ï‡•á‡§Ç",
                resumeBotResponses: "üîä ‡§¨‡•â‡§ü ‡§™‡•ç‡§∞‡§§‡§ø‡§ï‡•ç‡§∞‡§ø‡§Ø‡§æ‡§è‡§Ç ‡§™‡•Å‡§®‡§É ‡§∂‡•Å‡§∞‡•Ç ‡§ï‡§∞‡•á‡§Ç",
                stopBotResponseButtonText: "‡§¨‡•â‡§ü ‡§ï‡•ã ‡§¨‡•ã‡§≤‡§®‡§æ ‡§¨‡§Ç‡§¶ ‡§ï‡§∞‡•á‡§Ç",
                questionsAsked: "‡§™‡•Ç‡§õ‡•á ‡§ó‡§è ‡§™‡•ç‡§∞‡§∂‡•ç‡§®",
                thisSession: "‡§á‡§∏ ‡§∏‡§§‡•ç‡§∞ ‡§Æ‡•á‡§Ç",
                resetCounter: "‡§ï‡§æ‡§â‡§Ç‡§ü‡§∞ ‡§∞‡•Ä‡§∏‡•á‡§ü ‡§ï‡§∞‡•á‡§Ç",
                exportStats: "‡§Ü‡§Å‡§ï‡§°‡§º‡•á ‡§®‡§ø‡§∞‡•ç‡§Ø‡§æ‡§§ ‡§ï‡§∞‡•á‡§Ç",
                counterResetMessage: "‡§™‡•ç‡§∞‡§∂‡•ç‡§® ‡§ï‡§æ‡§â‡§Ç‡§ü‡§∞ ‡§∏‡§´‡§≤‡§§‡§æ‡§™‡•Ç‡§∞‡•ç‡§µ‡§ï ‡§∞‡•Ä‡§∏‡•á‡§ü ‡§π‡•ã ‡§ó‡§Ø‡§æ ‡§π‡•à!",
                statsExportedMessage: "‡§Ü‡§Å‡§ï‡§°‡§º‡•á ‡§∏‡§´‡§≤‡§§‡§æ‡§™‡•Ç‡§∞‡•ç‡§µ‡§ï ‡§®‡§ø‡§∞‡•ç‡§Ø‡§æ‡§§ ‡§π‡•ã ‡§ó‡§è ‡§π‡•à‡§Ç!",
                fileLoaded: (fileName) => `üìÑ ‡§´‡§º‡§æ‡§á‡§≤ "${fileName}" ‡§≤‡•ã‡§° ‡§π‡•ã ‡§ó‡§à ‡§π‡•à‡•§ ‡§Ö‡§¨ ‡§Ü‡§™ ‡§á‡§∏‡§ï‡•Ä ‡§∏‡§æ‡§Æ‡§ó‡•ç‡§∞‡•Ä ‡§ï‡•á ‡§¨‡§æ‡§∞‡•á ‡§Æ‡•á‡§Ç ‡§™‡•ç‡§∞‡§∂‡•ç‡§® ‡§™‡•Ç‡§õ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç‡•§`,
                fileContextCleared: "üìÑ ‡§´‡§º‡§æ‡§á‡§≤ ‡§∏‡§Ç‡§¶‡§∞‡•ç‡§≠ ‡§∏‡§æ‡§´‡§º ‡§ï‡§∞ ‡§¶‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ ‡§π‡•à‡•§",
                fileReadError: (fileName) => `‚ö†Ô∏è ‡§´‡§º‡§æ‡§á‡§≤ "${fileName}" ‡§™‡§¢‡§º‡§®‡•á ‡§Æ‡•á‡§Ç ‡§§‡•ç‡§∞‡•Å‡§ü‡§ø‡•§ ‡§ï‡•É‡§™‡§Ø‡§æ ‡§∏‡•Å‡§®‡§ø‡§∂‡•ç‡§ö‡§ø‡§§ ‡§ï‡§∞‡•á‡§Ç ‡§ï‡§ø ‡§Ø‡§π ‡§è‡§ï ‡§Æ‡§æ‡§®‡•ç‡§Ø .txt ‡§Ø‡§æ .pdf ‡§´‡§º‡§æ‡§á‡§≤ ‡§π‡•à‡•§`,
                fileTooLarge: (size) => `‚ö†Ô∏è ‡§´‡§º‡§æ‡§á‡§≤ ‡§¨‡§π‡•Å‡§§ ‡§¨‡§°‡§º‡•Ä ‡§π‡•à (${size}MB)‡•§ ‡§ï‡•É‡§™‡§Ø‡§æ 5MB ‡§∏‡•á ‡§õ‡•ã‡§ü‡•Ä ‡§´‡§º‡§æ‡§á‡§≤ ‡§Ö‡§™‡§≤‡•ã‡§° ‡§ï‡§∞‡•á‡§Ç‡•§`
            },
            mr: {
                welcome: "üëã ‡§∏‡•ç‡§µ‡§æ‡§ó‡§§ ‡§Ü‡§π‡•á! ‡§Æ‡•Ä '‡§ï‡•É‡§∑‡•Ä ‡§∏‡§Æ‡§æ‡§ß‡§æ‡§®' ‡§Ü‡§π‡•á, ‡§§‡•Å‡§Æ‡§ö‡§æ ‡§ï‡•É‡§∑‡•Ä ‡§∏‡§≤‡•ç‡§≤‡§æ‡§ó‡§æ‡§∞‡•§ ‡§ï‡•É‡§∑‡•Ä-‡§∏‡§Ç‡§¨‡§Ç‡§ß‡§ø‡§§ ‡§∏‡§∞‡•ç‡§µ ‡§™‡•ç‡§∞‡§∂‡•ç‡§®‡§æ‡§Ç‡§Æ‡§ß‡•ç‡§Ø‡•á ‡§§‡•Å‡§Æ‡§ö‡•ç‡§Ø‡§æ ‡§Æ‡§¶‡§§‡•Ä‡§∏‡§æ‡§†‡•Ä ‡§Ø‡•á‡§•‡•á ‡§Ü‡§π‡•á. ‡§§‡•Å‡§Æ‡•ç‡§π‡•Ä ‡§∏‡§Ç‡§¶‡§∞‡•ç‡§≠-‡§µ‡§ø‡§∂‡§ø‡§∑‡•ç‡§ü ‡§™‡•ç‡§∞‡§∂‡•ç‡§®‡§æ‡§Ç‡§∏‡§æ‡§†‡•Ä .txt ‡§ï‡§ø‡§Ç‡§µ‡§æ .pdf ‡§´‡§æ‡§à‡§≤ ‡§∏‡§Ç‡§≤‡§ó‡•ç‡§® ‡§ï‡§∞‡•Ç ‡§∂‡§ï‡§§‡§æ.",
                settings: "‡§∏‡•á‡§ü‡§ø‡§Ç‡§ó‡•ç‡§ú",
                model: "AI ‡§Æ‡•â‡§°‡•á‡§≤",
                systemPrompt: "‡§∏‡§ø‡§∏‡•ç‡§ü‡§Æ ‡§∏‡•Ç‡§ö‡§®‡§æ",
                inputPlaceholder: "‡§§‡•Å‡§Æ‡§ö‡§æ ‡§∏‡§Ç‡§¶‡•á‡§∂ ‡§Ø‡•á‡§•‡•á ‡§ü‡§æ‡§á‡§™ ‡§ï‡§∞‡§æ...",
                send: "‡§™‡§æ‡§†‡§µ‡§æ",
                errorNoMessage: "‡§ï‡•É‡§™‡§Ø‡§æ ‡§è‡§ï ‡§∏‡§Ç‡§¶‡•á‡§∂ ‡§™‡•ç‡§∞‡§µ‡§ø‡§∑‡•ç‡§ü ‡§ï‡§∞‡§æ",
                powered: "‡§§‡•Å‡§Æ‡§ö‡§æ ‡§ï‡•É‡§∑‡•Ä ‡§∏‡§æ‡§•‡•Ä, ‡§™‡•ç‡§∞‡§§‡•ç‡§Ø‡•á‡§ï ‡§∏‡§Æ‡§∏‡•ç‡§Ø‡•á‡§ö‡•á ‡§∏‡§Æ‡§æ‡§ß‡§æ‡§®",
                language: "‡§≠‡§æ‡§∑‡§æ",
                close: "‡§¨‡§Ç‡§¶ ‡§ï‡§∞‡§æ",
                thinking: "ü§ñ AI ‡§µ‡§ø‡§ö‡§æ‡§∞ ‡§ï‡§∞‡§§ ‡§Ü‡§π‡•á...",
                languageName: "Marathi",
                voiceInput: "‡§Ü‡§µ‡§æ‡§ú ‡§á‡§®‡§™‡•Å‡§ü",
                startListening: "‡§ê‡§ï‡§£‡•á ‡§∏‡•Å‡§∞‡•Ç ‡§ï‡§∞‡§æ",
                stopListening: "‡§ê‡§ï‡§£‡•á ‡§¨‡§Ç‡§¶ ‡§ï‡§∞‡§æ",
                voiceStatusStart: "‡§¨‡•ã‡§≤‡§£‡•á ‡§∏‡•Å‡§∞‡•Ç ‡§ï‡§∞‡§£‡•ç‡§Ø‡§æ‡§∏‡§æ‡§†‡•Ä \"‡§ê‡§ï‡§£‡•á ‡§∏‡•Å‡§∞‡•Ç ‡§ï‡§∞‡§æ\" ‡§µ‡§∞ ‡§ï‡•ç‡§≤‡§ø‡§ï ‡§ï‡§∞‡§æ...",
                voiceStatusListening: "‡§ê‡§ï‡§§ ‡§Ü‡§π‡•á... ‡§Ü‡§§‡§æ ‡§¨‡•ã‡§≤‡§æ‡•§",
                voiceStatusReady: "‡§™‡§æ‡§†‡§µ‡§£‡•ç‡§Ø‡§æ‡§∏‡§æ‡§†‡•Ä ‡§§‡§Ø‡§æ‡§∞‡•§ ‡§∏‡•Å‡§∞‡•Ç ‡§†‡•á‡§µ‡§£‡•ç‡§Ø‡§æ‡§∏‡§æ‡§†‡•Ä '‡§™‡§æ‡§†‡§µ‡§æ' ‡§µ‡§∞ ‡§ï‡•ç‡§≤‡§ø‡§ï ‡§ï‡§∞‡§æ‡•§",
                voiceStatusError: "‡§§‡•ç‡§∞‡•Å‡§ü‡•Ä ‡§ù‡§æ‡§≤‡•Ä. ‡§ï‡•É‡§™‡§Ø‡§æ ‡§™‡•Å‡§®‡•ç‡§π‡§æ ‡§™‡•ç‡§∞‡§Ø‡§§‡•ç‡§® ‡§ï‡§∞‡§æ‡•§",
                transcriptionPlaceholder: "‡§§‡•Å‡§Æ‡§ö‡•á ‡§≠‡§æ‡§∑‡§£ ‡§Ø‡•á‡§•‡•á ‡§¶‡§ø‡§∏‡•á‡§≤...",
                textMode: "üí¨ ‡§Æ‡§ú‡§ï‡•Ç‡§∞ ‡§Æ‡•ã‡§°",
                speechMode: "üé§ ‡§∏‡•ç‡§™‡•Ä‡§ö ‡§Æ‡•ã‡§°",
                stopBotResponses: "üîá ‡§¨‡•â‡§ü ‡§™‡•ç‡§∞‡§§‡§ø‡§∏‡§æ‡§¶ ‡§•‡§æ‡§Ç‡§¨‡§µ‡§æ",
                resumeBotResponses: "üîä ‡§¨‡•â‡§ü ‡§™‡•ç‡§∞‡§§‡§ø‡§∏‡§æ‡§¶ ‡§™‡•Å‡§®‡•ç‡§π‡§æ ‡§∏‡•Å‡§∞‡•Ç ‡§ï‡§∞‡§æ",
                stopBotResponseButtonText: "‡§¨‡•â‡§ü‡§≤‡§æ ‡§¨‡•ã‡§≤‡§£‡•á ‡§•‡§æ‡§Ç‡§¨‡§µ‡§æ",
                questionsAsked: "‡§µ‡§ø‡§ö‡§æ‡§∞‡§≤‡•á‡§≤‡•á ‡§™‡•ç‡§∞‡§∂‡•ç‡§®",
                thisSession: "‡§Ø‡§æ ‡§∏‡§§‡•ç‡§∞‡§æ‡§§",
                resetCounter: "‡§ï‡§æ‡§â‡§Ç‡§ü‡§∞ ‡§∞‡•Ä‡§∏‡•á‡§ü ‡§ï‡§∞‡§æ",
                exportStats: "‡§Ü‡§ï‡§°‡•á‡§µ‡§æ‡§∞‡•Ä ‡§®‡§ø‡§∞‡•ç‡§Ø‡§æ‡§§ ‡§ï‡§∞‡§æ",
                counterResetMessage: "‡§™‡•ç‡§∞‡§∂‡•ç‡§® ‡§ï‡§æ‡§â‡§Ç‡§ü‡§∞ ‡§Ø‡§∂‡§∏‡•ç‡§µ‡•Ä‡§∞‡§ø‡§§‡•ç‡§Ø‡§æ ‡§∞‡•Ä‡§∏‡•á‡§ü ‡§ù‡§æ‡§≤‡§æ ‡§Ü‡§π‡•á!",
                statsExportedMessage: "‡§Ü‡§ï‡§°‡•á‡§µ‡§æ‡§∞‡•Ä ‡§Ø‡§∂‡§∏‡•ç‡§µ‡•Ä‡§∞‡§ø‡§§‡•ç‡§Ø‡§æ ‡§®‡§ø‡§∞‡•ç‡§Ø‡§æ‡§§ ‡§ù‡§æ‡§≤‡•Ä ‡§Ü‡§π‡•á!",
                fileLoaded: (fileName) => `üìÑ ‡§´‡§æ‡§à‡§≤ "${fileName}" ‡§≤‡•ã‡§° ‡§ù‡§æ‡§≤‡•Ä ‡§Ü‡§π‡•á. ‡§§‡•Å‡§Æ‡•ç‡§π‡•Ä ‡§Ü‡§§‡§æ ‡§§‡§ø‡§ö‡•ç‡§Ø‡§æ ‡§∏‡§æ‡§Æ‡§ó‡•ç‡§∞‡•Ä‡§¨‡§¶‡•ç‡§¶‡§≤ ‡§™‡•ç‡§∞‡§∂‡•ç‡§® ‡§µ‡§ø‡§ö‡§æ‡§∞‡•Ç ‡§∂‡§ï‡§§‡§æ.`,
                fileContextCleared: "üìÑ ‡§´‡§æ‡§à‡§≤ ‡§∏‡§Ç‡§¶‡§∞‡•ç‡§≠ ‡§∏‡§æ‡§´ ‡§ù‡§æ‡§≤‡§æ ‡§Ü‡§π‡•á.",
                fileReadError: (fileName) => `‚ö†Ô∏è ‡§´‡§æ‡§à‡§≤ "${fileName}" ‡§µ‡§æ‡§ö‡§£‡•ç‡§Ø‡§æ‡§§ ‡§§‡•ç‡§∞‡•Å‡§ü‡•Ä. ‡§ï‡•É‡§™‡§Ø‡§æ ‡§ñ‡§æ‡§§‡•ç‡§∞‡•Ä ‡§ï‡§∞‡§æ ‡§ï‡•Ä ‡§π‡•Ä ‡§è‡§ï ‡§µ‡•à‡§ß .txt ‡§ï‡§ø‡§Ç‡§µ‡§æ .pdf ‡§´‡§æ‡§à‡§≤ ‡§Ü‡§π‡•á.`,
                fileTooLarge: (size) => `‚ö†Ô∏è ‡§´‡§æ‡§à‡§≤ ‡§ñ‡•Ç‡§™ ‡§Æ‡•ã‡§†‡•Ä ‡§Ü‡§π‡•á (${size}MB). ‡§ï‡•É‡§™‡§Ø‡§æ 5MB ‡§™‡•á‡§ï‡•ç‡§∑‡§æ ‡§≤‡§π‡§æ‡§® ‡§´‡§æ‡§à‡§≤ ‡§Ö‡§™‡§≤‡•ã‡§° ‡§ï‡§∞‡§æ.`
            },
            ta: {
                welcome: "üëã ‡Æµ‡Æ∞‡Æµ‡Øá‡Æ±‡Øç‡Æï‡Æø‡Æ±‡Øã‡ÆÆ‡Øç! ‡Æ®‡Ææ‡Æ©‡Øç '‡Æï‡Æø‡Æ∞‡ØÅ‡Æ∑‡Æø ‡Æö‡ÆÆ‡Ææ‡Æ§‡Ææ‡Æ©‡Øç', ‡Æâ‡Æô‡Øç‡Æï‡Æ≥‡Øç ‡Æµ‡Øá‡Æ≥‡Ææ‡Æ£‡Øç ‡ÆÜ‡Æ≤‡Øã‡Æö‡Æï‡Æ∞‡Øç. ‡Æµ‡Æø‡Æµ‡Æö‡Ææ‡ÆØ‡ÆÆ‡Øç ‡Æ§‡Øä‡Æü‡Æ∞‡Øç‡Æ™‡Ææ‡Æ© ‡ÆÖ‡Æ©‡Øà‡Æ§‡Øç‡Æ§‡ØÅ ‡Æï‡Øá‡Æ≥‡Øç‡Æµ‡Æø‡Æï‡Æ≥‡ØÅ‡Æï‡Øç‡Æï‡ØÅ‡ÆÆ‡Øç ‡Æâ‡Æ§‡Æµ ‡Æá‡Æô‡Øç‡Æï‡Øá ‡Æâ‡Æ≥‡Øç‡Æ≥‡Øá‡Æ©‡Øç. ‡Æö‡ØÇ‡Æ¥‡Æ≤‡Øç ‡Æö‡Ææ‡Æ∞‡Øç‡Æ®‡Øç‡Æ§ ‡Æï‡Øá‡Æ≥‡Øç‡Æµ‡Æø‡Æï‡Æ≥‡ØÅ‡Æï‡Øç‡Æï‡ØÅ ‡Æ®‡ØÄ‡Æô‡Øç‡Æï‡Æ≥‡Øç ‡Æí‡Æ∞‡ØÅ .txt ‡ÆÖ‡Æ≤‡Øç‡Æ≤‡Æ§‡ØÅ .pdf ‡Æï‡Øã‡Æ™‡Øç‡Æ™‡Øà ‡Æá‡Æ£‡Øà‡Æï‡Øç‡Æï‡Æ≤‡Ææ‡ÆÆ‡Øç.",
                settings: "‡ÆÖ‡ÆÆ‡Øà‡Æ™‡Øç‡Æ™‡ØÅ‡Æï‡Æ≥‡Øç",
                model: "AI ‡ÆÆ‡Ææ‡Æ§‡Æø‡Æ∞‡Æø",
                systemPrompt: "‡ÆÖ‡ÆÆ‡Øà‡Æ™‡Øç‡Æ™‡ØÅ ‡Æï‡ØÅ‡Æ±‡Æø‡Æ™‡Øç‡Æ™‡ØÅ",
                inputPlaceholder: "‡Æâ‡Æô‡Øç‡Æï‡Æ≥‡Øç ‡Æö‡ØÜ‡ÆØ‡Øç‡Æ§‡Æø‡ÆØ‡Øà ‡Æá‡Æô‡Øç‡Æï‡Øá ‡Æ§‡Æü‡Øç‡Æü‡Æö‡Øç‡Æö‡ØÅ ‡Æö‡ØÜ‡ÆØ‡Øç‡ÆØ‡Æµ‡ØÅ‡ÆÆ‡Øç...",
                send: "‡ÆÖ‡Æ©‡ØÅ‡Æ™‡Øç‡Æ™‡ØÅ",
                errorNoMessage: "‡Æ§‡ÆØ‡Æµ‡ØÅ‡Æö‡ØÜ‡ÆØ‡Øç‡Æ§‡ØÅ ‡Æí‡Æ∞‡ØÅ ‡Æö‡ØÜ‡ÆØ‡Øç‡Æ§‡Æø‡ÆØ‡Øà ‡Æâ‡Æ≥‡Øç‡Æ≥‡Æø‡Æü‡Æµ‡ØÅ‡ÆÆ‡Øç",
                powered: "‡Æâ‡Æô‡Øç‡Æï‡Æ≥‡Øç ‡Æµ‡Øá‡Æ≥‡Ææ‡Æ£‡Øç ‡Æ§‡ØÅ‡Æ£‡Øà, ‡ÆÖ‡Æ©‡Øà‡Æ§‡Øç‡Æ§‡ØÅ ‡Æ§‡ØÄ‡Æ∞‡Øç‡Æµ‡ØÅ‡Æï‡Æ≥‡ØÅ‡Æï‡Øç‡Æï‡ØÅ‡ÆÆ‡Øç",
                language: "‡ÆÆ‡Øä‡Æ¥‡Æø",
                close: "‡ÆÆ‡ØÇ‡Æü‡ØÅ",
                thinking: "ü§ñ AI ‡Æö‡Æø‡Æ®‡Øç‡Æ§‡Æø‡Æï‡Øç‡Æï‡Æø‡Æ±‡Æ§‡ØÅ...",
                languageName: "Tamil",
                voiceInput: "‡Æï‡ØÅ‡Æ∞‡Æ≤‡Øç ‡Æâ‡Æ≥‡Øç‡Æ≥‡ØÄ‡Æü‡ØÅ",
                startListening: "‡Æï‡Øá‡Æü‡Øç‡Æï ‡ÆÜ‡Æ∞‡ÆÆ‡Øç‡Æ™‡Æø‡Æï‡Øç‡Æï‡Æµ‡ØÅ‡ÆÆ‡Øç",
                stopListening: "‡Æï‡Øá‡Æü‡Øç‡Æ™‡Æ§‡Øà ‡Æ®‡Æø‡Æ±‡ØÅ‡Æ§‡Øç‡Æ§‡Æµ‡ØÅ‡ÆÆ‡Øç",
                voiceStatusStart: "‡Æ™‡Øá‡Æö‡Æ§‡Øç ‡Æ§‡Øä‡Æü‡Æô‡Øç‡Æï \"‡Æï‡Øá‡Æü‡Øç‡Æï ‡ÆÜ‡Æ∞‡ÆÆ‡Øç‡Æ™‡Æø‡Æï‡Øç‡Æï‡Æµ‡ØÅ‡ÆÆ‡Øç\" ‡Æé‡Æ©‡Øç‡Æ™‡Æ§‡Øà‡Æï‡Øç ‡Æï‡Æø‡Æ≥‡Æø‡Æï‡Øç ‡Æö‡ØÜ‡ÆØ‡Øç‡ÆØ‡Æµ‡ØÅ‡ÆÆ‡Øç...",
                voiceStatusListening: "‡Æï‡Øá‡Æü‡Øç‡Æï‡Æø‡Æ±‡Æ§‡ØÅ... ‡Æá‡Æ™‡Øç‡Æ™‡Øã‡Æ§‡ØÅ ‡Æ™‡Øá‡Æö‡ØÅ‡Æô‡Øç‡Æï‡Æ≥‡Øç‡•§",
                voiceStatusReady: "‡ÆÖ‡Æ©‡ØÅ‡Æ™‡Øç‡Æ™ ‡Æ§‡ÆØ‡Ææ‡Æ∞‡Øç. ‡Æ§‡Øä‡Æü‡Æ∞ '‡ÆÖ‡Æ©‡ØÅ‡Æ™‡Øç‡Æ™‡ØÅ' ‡Æé‡Æ©‡Øç‡Æ™‡Æ§‡Øà‡Æï‡Øç ‡Æï‡Æø‡Æ≥‡Æø‡Æï‡Øç ‡Æö‡ØÜ‡ÆØ‡Øç‡ÆØ‡Æµ‡ØÅ‡ÆÆ‡Øç‡•§",
                voiceStatusError: "‡Æ™‡Æø‡Æ¥‡Øà ‡Æè‡Æ±‡Øç‡Æ™‡Æü‡Øç‡Æü‡Æ§‡ØÅ. ‡Æ§‡ÆØ‡Æµ‡ØÅ‡Æö‡ØÜ‡ÆØ‡Øç‡Æ§‡ØÅ ‡ÆÆ‡ØÄ‡Æ£‡Øç‡Æü‡ØÅ‡ÆÆ‡Øç ‡ÆÆ‡ØÅ‡ÆØ‡Æ±‡Øç‡Æö‡Æø‡Æï‡Øç‡Æï‡Æµ‡ØÅ‡ÆÆ‡Øç‡•§",
                transcriptionPlaceholder: "‡Æâ‡Æô‡Øç‡Æï‡Æ≥‡Øç ‡Æ™‡Øá‡Æö‡Øç‡Æö‡ØÅ ‡Æá‡Æô‡Øç‡Æï‡Øá ‡Æ§‡Øã‡Æ©‡Øç‡Æ±‡ØÅ‡ÆÆ‡Øç...",
                textMode: "üí¨ ‡Æâ‡Æ∞‡Øà ‡ÆÆ‡ØÅ‡Æ±‡Øà",
                speechMode: "üé§ ‡Æ™‡Øá‡Æö‡Øç‡Æö‡ØÅ ‡ÆÆ‡ØÅ‡Æ±‡Øà",
                stopBotResponses: "üîá ‡Æ™‡Ææ‡Æü‡Øç ‡Æ™‡Æ§‡Æø‡Æ≤‡Øç‡Æï‡Æ≥‡Øà ‡Æ®‡Æø‡Æ±‡ØÅ‡Æ§‡Øç‡Æ§‡ØÅ",
                resumeBotResponses: "üîä ‡Æ™‡Ææ‡Æü‡Øç ‡Æ™‡Æ§‡Æø‡Æ≤‡Øç‡Æï‡Æ≥‡Øà ‡ÆÆ‡ØÄ‡Æ£‡Øç‡Æü‡ØÅ‡ÆÆ‡Øç ‡Æ§‡Øä‡Æü‡Æô‡Øç‡Æï‡ØÅ",
                stopBotResponseButtonText: "‡Æ™‡Ææ‡Æü‡Øç ‡Æ™‡Øá‡Æö‡ØÅ‡Æµ‡Æ§‡Øà ‡Æ®‡Æø‡Æ±‡ØÅ‡Æ§‡Øç‡Æ§‡ØÅ",
                questionsAsked: "‡Æï‡Øá‡Æ≥‡Øç‡Æµ‡Æø‡Æï‡Æ≥‡Øç ‡Æï‡Øá‡Æü‡Øç‡Æï‡Æ™‡Øç‡Æ™‡Æü‡Øç‡Æü‡Æ©",
                thisSession: "‡Æá‡Æ®‡Øç‡Æ§ ‡ÆÖ‡ÆÆ‡Æ∞‡Øç‡Æµ‡Æø‡Æ≤‡Øç",
                resetCounter: "‡Æï‡Æµ‡ØÅ‡Æ£‡Øç‡Æü‡Æ∞‡Øà ‡ÆÆ‡ØÄ‡Æü‡Øç‡Æü‡ÆÆ‡Øà",
                exportStats: "‡Æ™‡ØÅ‡Æ≥‡Øç‡Æ≥‡Æø‡Æµ‡Æø‡Æµ‡Æ∞‡Æô‡Øç‡Æï‡Æ≥‡Øà ‡Æè‡Æ±‡Øç‡Æ±‡ØÅ‡ÆÆ‡Æ§‡Æø ‡Æö‡ØÜ‡ÆØ‡Øç",
                counterResetMessage: "‡Æï‡Øá‡Æ≥‡Øç‡Æµ‡Æø ‡Æï‡Æµ‡ØÅ‡Æ£‡Øç‡Æü‡Æ∞‡Øç ‡Æµ‡ØÜ‡Æ±‡Øç‡Æ±‡Æø‡Æï‡Æ∞‡ÆÆ‡Ææ‡Æï ‡ÆÆ‡ØÄ‡Æü‡Øç‡Æü‡ÆÆ‡Øà‡Æï‡Øç‡Æï‡Æ™‡Øç‡Æ™‡Æü‡Øç‡Æü‡Æ§‡ØÅ!",
                statsExportedMessage: "‡Æ™‡ØÅ‡Æ≥‡Øç‡Æ≥‡Æø‡Æµ‡Æø‡Æµ‡Æ∞‡Æô‡Øç‡Æï‡Æ≥‡Øç ‡Æµ‡ØÜ‡Æ±‡Øç‡Æ±‡Æø‡Æï‡Æ∞‡ÆÆ‡Ææ‡Æï ‡Æè‡Æ±‡Øç‡Æ±‡ØÅ‡ÆÆ‡Æ§‡Æø ‡Æö‡ØÜ‡ÆØ‡Øç‡ÆØ‡Æ™‡Øç‡Æ™‡Æü‡Øç‡Æü‡Æ©!",
                fileLoaded: (fileName) => `üìÑ ‡Æï‡Øã‡Æ™‡Øç‡Æ™‡ØÅ "${fileName}" ‡Æè‡Æ±‡Øç‡Æ±‡Æ™‡Øç‡Æ™‡Æü‡Øç‡Æü‡Æ§‡ØÅ. ‡ÆÖ‡Æ§‡Æ©‡Øç ‡Æâ‡Æ≥‡Øç‡Æ≥‡Æü‡Æï‡Øç‡Æï‡Æ§‡Øç‡Æ§‡Øà‡Æ™‡Øç ‡Æ™‡Æ±‡Øç‡Æ±‡Æø ‡Æ®‡ØÄ‡Æô‡Øç‡Æï‡Æ≥‡Øç ‡Æá‡Æ™‡Øç‡Æ™‡Øã‡Æ§‡ØÅ ‡Æï‡Øá‡Æ≥‡Øç‡Æµ‡Æø‡Æï‡Æ≥‡Øç ‡Æï‡Øá‡Æü‡Øç‡Æï‡Æ≤‡Ææ‡ÆÆ‡Øç.`,
                fileContextCleared: "üìÑ ‡Æï‡Øã‡Æ™‡Øç‡Æ™‡ØÅ ‡Æö‡ØÇ‡Æ¥‡Æ≤‡Øç ‡ÆÖ‡Æ¥‡Æø‡Æï‡Øç‡Æï‡Æ™‡Øç‡Æ™‡Æü‡Øç‡Æü‡Æ§‡ØÅ.",
                fileReadError: (fileName) => `‚ö†Ô∏è ‡Æï‡Øã‡Æ™‡Øç‡Æ™‡ØÅ "${fileName}" ‡Æ™‡Æü‡Æø‡Æ™‡Øç‡Æ™‡Æ§‡Æø‡Æ≤‡Øç ‡Æ™‡Æø‡Æ¥‡Øà. ‡Æá‡Æ§‡ØÅ ‡Æí‡Æ∞‡ØÅ ‡Æö‡Æ∞‡Æø‡ÆØ‡Ææ‡Æ© .txt ‡ÆÖ‡Æ≤‡Øç‡Æ≤‡Æ§‡ØÅ .pdf ‡Æï‡Øã‡Æ™‡Øç‡Æ™‡ØÅ ‡Æé‡Æ©‡Øç‡Æ™‡Æ§‡Øà ‡Æâ‡Æ±‡ØÅ‡Æ§‡Æø‡Æ™‡Øç‡Æ™‡Æü‡ØÅ‡Æ§‡Øç‡Æ§‡Æµ‡ØÅ‡ÆÆ‡Øç.`,
                fileTooLarge: (size) => `‚ö†Ô∏è ‡Æï‡Øã‡Æ™‡Øç‡Æ™‡ØÅ ‡ÆÆ‡Æø‡Æï‡Æ™‡Øç ‡Æ™‡ØÜ‡Æ∞‡Æø‡ÆØ‡Æ§‡ØÅ (${size}MB). ‡Æ§‡ÆØ‡Æµ‡ØÅ‡Æö‡ØÜ‡ÆØ‡Øç‡Æ§‡ØÅ 5MB ‡Æï‡Øç‡Æï‡ØÅ‡ÆÆ‡Øç ‡Æö‡Æø‡Æ±‡Æø‡ÆØ ‡Æï‡Øã‡Æ™‡Øç‡Æ™‡Øà ‡Æ™‡Æ§‡Æø‡Æµ‡Øá‡Æ±‡Øç‡Æ±‡Æµ‡ØÅ‡ÆÆ‡Øç.`
            },
            bn: {
                welcome: "üëã ‡¶∏‡ßç‡¶¨‡¶æ‡¶ó‡¶§‡¶Æ! ‡¶Ü‡¶Æ‡¶ø '‡¶ï‡ßÉ‡¶∑‡¶ø ‡¶∏‡¶Æ‡¶æ‡¶ß‡¶æ‡¶®', ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶ï‡ßÉ‡¶∑‡¶ø ‡¶â‡¶™‡¶¶‡ßá‡¶∑‡ßç‡¶ü‡¶æ‡•§ ‡¶ï‡ßÉ‡¶∑‡¶ø-‡¶∏‡¶Æ‡ßç‡¶™‡¶∞‡ßç‡¶ï‡¶ø‡¶§ ‡¶∏‡¶ï‡¶≤ ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶®‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶Ü‡¶™‡¶®‡¶æ‡¶ï‡ßá ‡¶∏‡¶æ‡¶π‡¶æ‡¶Ø‡ßç‡¶Ø ‡¶ï‡¶∞‡¶§‡ßá ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶Ü‡¶õ‡¶ø‡•§ ‡¶™‡ßç‡¶∞‡¶æ‡¶∏‡¶ô‡ßç‡¶ó‡¶ø‡¶ï ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶®‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶Ü‡¶™‡¶®‡¶ø ‡¶è‡¶ï‡¶ü‡¶ø .txt ‡¶¨‡¶æ .pdf ‡¶´‡¶æ‡¶á‡¶≤ ‡¶∏‡¶Ç‡¶Ø‡ßÅ‡¶ï‡ßç‡¶§ ‡¶ï‡¶∞‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá‡¶®‡•§",
                settings: "‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç‡¶∏",
                model: "AI ‡¶Æ‡¶°‡ßá‡¶≤",
                systemPrompt: "‡¶∏‡¶ø‡¶∏‡ßç‡¶ü‡ßá‡¶Æ ‡¶™‡ßç‡¶∞‡¶Æ‡ßç‡¶™‡¶ü",
                inputPlaceholder: "‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶¨‡¶æ‡¶∞‡ßç‡¶§‡¶æ ‡¶ü‡¶æ‡¶á‡¶™ ‡¶ï‡¶∞‡ßÅ‡¶®...",
                send: "‡¶™‡¶æ‡¶†‡¶æ‡¶®",
                errorNoMessage: "‡¶Ö‡¶®‡ßÅ‡¶ó‡ßç‡¶∞‡¶π ‡¶ï‡¶∞‡ßá ‡¶è‡¶ï‡¶ü‡¶ø ‡¶¨‡¶æ‡¶∞‡ßç‡¶§‡¶æ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®",
                powered: "‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶ï‡ßÉ‡¶∑‡¶ø ‡¶∏‡¶π‡¶Ø‡ßã‡¶ó‡ßÄ, ‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶ü‡¶ø ‡¶∏‡¶Æ‡¶æ‡¶ß‡¶æ‡¶®‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø",
                language: "‡¶≠‡¶æ‡¶∑‡¶æ",
                close: "‡¶¨‡¶®‡ßç‡¶ß",
                thinking: "ü§ñ AI ‡¶ö‡¶ø‡¶®‡ßç‡¶§‡¶æ ‡¶ï‡¶∞‡¶õ‡ßá...",
                languageName: "Bengali",
                voiceInput: "‡¶≠‡¶Ø‡¶º‡ßá‡¶∏ ‡¶á‡¶®‡¶™‡ßÅ‡¶ü",
                startListening: "‡¶∂‡ßã‡¶®‡¶æ ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶ï‡¶∞‡ßÅ‡¶®",
                stopListening: "‡¶∂‡ßã‡¶®‡¶æ ‡¶¨‡¶®‡ßç‡¶ß ‡¶ï‡¶∞‡ßÅ‡¶®",
                voiceStatusStart: "‡¶ï‡¶•‡¶æ ‡¶¨‡¶≤‡¶æ ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶ï‡¶∞‡¶§‡ßá \"‡¶∂‡ßã‡¶®‡¶æ ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶ï‡¶∞‡ßÅ‡¶®\" ‡¶è ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶ï‡¶∞‡ßÅ‡¶®...",
                voiceStatusListening: "‡¶∂‡ßÅ‡¶®‡¶õ‡ßá... ‡¶è‡¶ñ‡¶® ‡¶¨‡¶≤‡ßÅ‡¶®‡•§",
                voiceStatusReady: "‡¶™‡¶æ‡¶†‡¶æ‡¶®‡ßã‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶™‡ßç‡¶∞‡¶∏‡ßç‡¶§‡ßÅ‡¶§‡•§ ‡¶ö‡¶æ‡¶≤‡¶ø‡¶Ø‡¶º‡ßá ‡¶Ø‡ßá‡¶§‡ßá '‡¶™‡¶æ‡¶†‡¶æ‡¶®' ‡¶è ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶ï‡¶∞‡ßÅ‡¶®‡•§",
                voiceStatusError: "‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø ‡¶ò‡¶ü‡ßá‡¶õ‡ßá‡•§ ‡¶Ö‡¶®‡ßÅ‡¶ó‡ßç‡¶∞‡¶π ‡¶ï‡¶∞‡ßá ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§",
                transcriptionPlaceholder: "‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶¨‡¶ï‡ßç‡¶§‡ßÉ‡¶§‡¶æ ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶™‡ßç‡¶∞‡¶¶‡¶∞‡ßç‡¶∂‡¶ø‡¶§ ‡¶π‡¶¨‡ßá...",
                textMode: "üí¨ ‡¶ü‡ßá‡¶ï‡ßç‡¶∏‡¶ü ‡¶Æ‡ßã‡¶°",
                speechMode: "üé§ ‡¶∏‡ßç‡¶™‡¶ø‡¶ö ‡¶Æ‡ßã‡¶°",
                stopBotResponses: "üîá ‡¶¨‡¶ü ‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶ï‡ßç‡¶∞‡¶ø‡¶Ø‡¶º‡¶æ ‡¶¨‡¶®‡ßç‡¶ß ‡¶ï‡¶∞‡ßÅ‡¶®",
                resumeBotResponses: "üîä ‡¶¨‡¶ü ‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶ï‡ßç‡¶∞‡¶ø‡¶Ø‡¶º‡¶æ ‡¶™‡ßÅ‡¶®‡¶∞‡¶æ‡¶Ø‡¶º ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶ï‡¶∞‡ßÅ‡¶®",
                stopBotResponseButtonText: "‡¶¨‡¶ü‡¶ï‡ßá ‡¶ï‡¶•‡¶æ ‡¶¨‡¶≤‡¶æ ‡¶¨‡¶®‡ßç‡¶ß ‡¶ï‡¶∞‡ßÅ‡¶®",
                questionsAsked: "‡¶ú‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶∏‡¶ø‡¶§ ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶®",
                thisSession: "‡¶è‡¶á ‡¶∏‡ßá‡¶∂‡¶®‡ßá",
                resetCounter: "‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü‡¶æ‡¶∞ ‡¶∞‡¶ø‡¶∏‡ßá‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®",
                exportStats: "‡¶™‡¶∞‡¶ø‡¶∏‡¶Ç‡¶ñ‡ßç‡¶Ø‡¶æ‡¶® ‡¶∞‡¶™‡ßç‡¶§‡¶æ‡¶®‡¶ø ‡¶ï‡¶∞‡ßÅ‡¶®",
                counterResetMessage: "‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶® ‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü‡¶æ‡¶∞ ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶∞‡¶ø‡¶∏‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!",
                statsExportedMessage: "‡¶™‡¶∞‡¶ø‡¶∏‡¶Ç‡¶ñ‡ßç‡¶Ø‡¶æ‡¶® ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶∞‡¶™‡ßç‡¶§‡¶æ‡¶®‡¶ø ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!",
                fileLoaded: (fileName) => `üìÑ ‡¶´‡¶æ‡¶á‡¶≤ "${fileName}" ‡¶≤‡ßã‡¶° ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§ ‡¶Ü‡¶™‡¶®‡¶ø ‡¶è‡¶ñ‡¶® ‡¶è‡¶∞ ‡¶¨‡¶ø‡¶∑‡¶Ø‡¶º‡¶¨‡¶∏‡ßç‡¶§‡ßÅ ‡¶∏‡¶Æ‡ßç‡¶™‡¶∞‡ßç‡¶ï‡ßá ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶® ‡¶ï‡¶∞‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá‡¶®‡•§`,
                fileContextCleared: "üìÑ ‡¶´‡¶æ‡¶á‡¶≤ ‡¶ï‡¶®‡¶ü‡ßá‡¶ï‡ßç‡¶∏‡¶ü ‡¶∏‡¶æ‡¶´ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§",
                fileReadError: (fileName) => `‚ö†Ô∏è ‡¶´‡¶æ‡¶á‡¶≤ "${fileName}" ‡¶™‡¶°‡¶º‡¶§‡ßá ‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø‡•§ ‡¶Ö‡¶®‡ßÅ‡¶ó‡ßç‡¶∞‡¶π ‡¶ï‡¶∞‡ßá ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§ ‡¶ï‡¶∞‡ßÅ‡¶® ‡¶è‡¶ü‡¶ø ‡¶è‡¶ï‡¶ü‡¶ø ‡¶¨‡ßà‡¶ß .txt ‡¶¨‡¶æ .pdf ‡¶´‡¶æ‡¶á‡¶≤‡•§`,
                fileTooLarge: (size) => `‚ö†Ô∏è ‡¶´‡¶æ‡¶á‡¶≤‡¶ü‡¶ø ‡¶ñ‡ßÅ‡¶¨ ‡¶¨‡¶°‡¶º (${size}MB). ‡¶Ö‡¶®‡ßÅ‡¶ó‡ßç‡¶∞‡¶π ‡¶ï‡¶∞‡ßá 5MB ‡¶è‡¶∞ ‡¶ö‡ßá‡¶Ø‡¶º‡ßá ‡¶õ‡ßã‡¶ü ‡¶´‡¶æ‡¶á‡¶≤ ‡¶Ü‡¶™‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡ßÅ‡¶®‡•§`
            },
            pa: {
                welcome: "üëã ‡®ú‡©Ä ‡®Ü‡®á‡®Ü‡®Ç ‡®®‡©Ç‡©∞! ‡®Æ‡©à‡®Ç '‡®ï‡©ç‡®∞‡®ø‡®∏‡®º‡©Ä ‡®∏‡®Æ‡®æ‡®ß‡®æ‡®®' ‡®π‡®æ‡®Ç, ‡®§‡©Å‡®π‡®æ‡®°‡®æ ‡®ñ‡©á‡®§‡©Ä‡®¨‡®æ‡©ú‡©Ä ‡®∏‡®≤‡®æ‡®π‡®ï‡®æ‡®∞‡•§ ‡®ñ‡©á‡®§‡©Ä‡®¨‡®æ‡©ú‡©Ä-‡®∏‡®¨‡©∞‡®ß‡®§ ‡®∏‡®æ‡®∞‡©á ‡®∏‡®µ‡®æ‡®≤‡®æ‡®Ç ‡®µ‡®ø‡©±‡®ö ‡®§‡©Å‡®π‡®æ‡®°‡©Ä ‡®Æ‡®¶‡®¶ ‡®ï‡®∞‡®® ‡®≤‡®à ‡®á‡©±‡®•‡©á ‡®π‡®æ‡®Ç‡•§ ‡®§‡©Å‡®∏‡©Ä‡®Ç ‡®™‡©ç‡®∞‡®∏‡©∞‡®ó-‡®µ‡®ø‡®∏‡®º‡©á‡®∏‡®º ‡®∏‡®µ‡®æ‡®≤‡®æ‡®Ç ‡®≤‡®à ‡®á‡©±‡®ï .txt ‡®ú‡®æ‡®Ç .pdf ‡®´‡®æ‡®à‡®≤ ‡®®‡©±‡®•‡©Ä ‡®ï‡®∞ ‡®∏‡®ï‡®¶‡©á ‡®π‡©ã‡•§",
                settings: "‡®∏‡©à‡®ü‡®ø‡©∞‡®ó‡®æ‡®Ç",
                model: "AI ‡®Æ‡®æ‡®°‡®≤",
                systemPrompt: "‡®∏‡®ø‡®∏‡®ü‡®Æ ‡®™‡©ç‡®∞‡©ã‡®Æ‡®™‡®ü",
                inputPlaceholder: "‡®Ü‡®™‡®£‡®æ ‡®∏‡©Å‡®®‡©á‡®π‡®æ ‡®á‡©±‡®•‡©á ‡®≤‡®ø‡®ñ‡©ã...",
                send: "‡®≠‡©á‡®ú‡©ã",
                errorNoMessage: "‡®ï‡®ø‡®∞‡®™‡®æ ‡®ï‡®∞‡®ï‡©á ‡®á‡©±‡®ï ‡®∏‡©Å‡®®‡©á‡®π‡®æ ‡®¶‡®∞‡®ú ‡®ï‡®∞‡©ã",
                powered: "‡®§‡©Å‡®π‡®æ‡®°‡®æ ‡®ñ‡©á‡®§‡©Ä‡®¨‡®æ‡©ú‡©Ä ‡®∏‡®æ‡®•‡©Ä, ‡®π‡®∞ ‡®∏‡®Æ‡©±‡®∏‡®ø‡®Ü ‡®≤‡®à",
                language: "‡®≠‡®æ‡®∏‡®º‡®æ",
                close: "‡®¨‡©∞‡®¶ ‡®ï‡®∞‡©ã",
                thinking: "ü§ñ AI ‡®∏‡©ã‡®ö ‡®∞‡®ø‡®π‡®æ ‡®π‡©à...",
                languageName: "Punjabi",
                voiceInput: "‡®Ü‡®µ‡®æ‡®ú‡®º ‡®á‡®®‡®™‡©Å‡®ü",
                startListening: "‡®∏‡©Å‡®£‡®®‡®æ ‡®∏‡®º‡©Å‡®∞‡©Ç ‡®ï‡®∞‡©ã",
                stopListening: "‡®∏‡©Å‡®£‡®®‡®æ ‡®¨‡©∞‡®¶ ‡®ï‡®∞‡©ã",
                voiceStatusStart: "‡®¨‡©ã‡®≤‡®£‡®æ ‡®∏‡®º‡©Å‡®∞‡©Ç ‡®ï‡®∞‡®® ‡®≤‡®à \"‡®∏‡©Å‡®£‡®®‡®æ ‡®∏‡®º‡©Å‡®∞‡©Ç ‡®ï‡®∞‡©ã\" ‡®§‡©á ‡®ï‡®≤‡®ø‡©±‡®ï ‡®ï‡®∞‡©ã...",
                voiceStatusListening: "‡®∏‡©Å‡®£ ‡®∞‡®ø‡®π‡®æ ‡®π‡©à... ‡®π‡©Å‡®£ ‡®¨‡©ã‡®≤‡©ã‡•§",
                voiceStatusReady: "‡®≠‡©á‡®ú‡®£ ‡®≤‡®à ‡®§‡®ø‡®Ü‡®∞‡•§ ‡®ú‡®æ‡®∞‡©Ä ‡®∞‡©±‡®ñ‡®£ ‡®≤‡®à '‡®≠‡©á‡®ú‡©ã' ‡®§‡©á ‡®ï‡®≤‡®ø‡©±‡®ï ‡®ï‡®∞‡©ã‡•§",
                voiceStatusError: "‡®ó‡®≤‡®§‡©Ä ‡®π‡©ã‡®à‡•§ ‡®ï‡®ø‡®∞‡®™‡®æ ‡®ï‡®∞‡®ï‡©á ‡®¶‡©Å‡®¨‡®æ‡®∞‡®æ ‡®ï‡©ã‡®∏‡®º‡®ø‡®∏‡®º ‡®ï‡®∞‡©ã‡•§",
                transcriptionPlaceholder: "‡®§‡©Å‡®π‡®æ‡®°‡®æ ‡®≠‡®æ‡®∏‡®º‡®£ ‡®á‡©±‡®•‡©á ‡®¶‡®ø‡®ñ‡®æ‡®à ‡®¶‡©á‡®µ‡©á‡®ó‡®æ...",
                textMode: "üí¨ ‡®ü‡©à‡®ï‡®∏‡®ü ‡®Æ‡©ã‡®°",
                speechMode: "üé§ ‡®∏‡®™‡©Ä‡®ö ‡®Æ‡©ã‡®°",
                stopBotResponses: "üîá ‡®¨‡©ã‡®ü ‡®™‡©ç‡®∞‡®§‡©Ä‡®ï‡®ø‡®∞‡®ø‡®Ü ‡®∞‡©ã‡®ï‡©ã",
                resumeBotResponses: "üîä ‡®¨‡©ã‡®ü ‡®™‡©ç‡®∞‡®§‡©Ä‡®ï‡®ø‡®∞‡®ø‡®Ü ‡®Æ‡©Å‡©ú ‡®ö‡®æ‡®≤‡©Ç ‡®ï‡®∞‡©ã",
                stopBotResponseButtonText: "‡®¨‡©ã‡®ü ‡®®‡©Ç‡©∞ ‡®¨‡©ã‡®≤‡®£‡®æ ‡®¨‡©∞‡®¶ ‡®ï‡®∞‡©ã",
                questionsAsked: "‡®™‡©Å‡©±‡®õ‡©á ‡®ó‡®è ‡®∏‡®µ‡®æ‡®≤",
                thisSession: "‡®á‡®∏ ‡®∏‡©à‡®∏‡®º‡®® ‡®µ‡®ø‡©±‡®ö",
                resetCounter: "‡®ï‡®æ‡®ä‡®Ç‡®ü‡®∞ ‡®∞‡©Ä‡®∏‡©à‡®ü ‡®ï‡®∞‡©ã",
                exportStats: "‡®Ö‡©∞‡®ï‡©ú‡©á ‡®®‡®ø‡®∞‡®Ø‡®æ‡®§ ‡®ï‡®∞‡©ã",
                counterResetMessage: "‡®™‡©ç‡®∞‡®∏‡®º‡®® ‡®ï‡®æ‡®ä‡®Ç‡®ü‡®∞ ‡®∏‡®´‡®≤‡®§‡®æ‡®™‡©Ç‡®∞‡®µ‡®ï ‡®∞‡©Ä‡®∏‡©à‡®ü ‡®π‡©ã ‡®ó‡®ø‡®Ü ‡®π‡©à!",
                statsExportedMessage: "‡®Ö‡©∞‡®ï‡©ú‡©á ‡®∏‡®´‡®≤‡®§‡®æ‡®™‡©Ç‡®∞‡®µ‡®ï ‡®®‡®ø‡®∞‡®Ø‡®æ‡®§ ‡®ï‡©Ä‡®§‡©á ‡®ó‡®è ‡®π‡®®!",
                fileLoaded: (fileName) => `üìÑ ‡®´‡®æ‡®à‡®≤ "${fileName}" ‡®≤‡©ã‡®° ‡®π‡©ã ‡®ó‡®à ‡®π‡©à‡•§ ‡®§‡©Å‡®∏‡©Ä‡®Ç ‡®π‡©Å‡®£ ‡®á‡®∏‡®¶‡©Ä ‡®∏‡®Æ‡©±‡®ó‡®∞‡©Ä ‡®¨‡®æ‡®∞‡©á ‡®∏‡®µ‡®æ‡®≤ ‡®™‡©Å‡©±‡®õ ‡®∏‡®ï‡®¶‡©á ‡®π‡©ã‡•§`,
                fileContextCleared: "üìÑ ‡®´‡®æ‡®à‡®≤ ‡®∏‡©∞‡®¶‡®∞‡®≠ ‡®∏‡®æ‡®´‡®º ‡®ï‡®∞ ‡®¶‡®ø‡©±‡®§‡®æ ‡®ó‡®ø‡®Ü ‡®π‡©à‡•§",
                fileReadError: (fileName) => `‚ö†Ô∏è ‡®´‡®æ‡®à‡®≤ "${fileName}" ‡®™‡©ú‡©ç‡®π‡®® ‡®µ‡®ø‡©±‡®ö ‡®ó‡®≤‡®§‡©Ä‡•§ ‡®ï‡®ø‡®∞‡®™‡®æ ‡®ï‡®∞‡®ï‡©á ‡®Ø‡®ï‡©Ä‡®®‡©Ä ‡®¨‡®£‡®æ‡®ì ‡®ï‡®ø ‡®á‡®π ‡®á‡©±‡®ï ‡®µ‡©à‡®ß .txt ‡®ú‡®æ‡®Ç .pdf ‡®´‡®æ‡®à‡®≤ ‡®π‡©à‡•§`,
                fileTooLarge: (size) => `‚ö†Ô∏è ‡®´‡®æ‡®à‡®≤ ‡®¨‡®π‡©Å‡®§ ‡®µ‡©±‡®°‡©Ä ‡®π‡©à (${size}MB). ‡®ï‡®ø‡®∞‡®™‡®æ ‡®ï‡®∞‡®ï‡©á 5MB ‡®§‡©ã‡®Ç ‡®õ‡©ã‡®ü‡©Ä ‡®´‡®æ‡®à‡®≤ ‡®Ö‡©±‡®™‡®≤‡©ã‡®° ‡®ï‡®∞‡©ã‡•§`
            },
            gu: {
                welcome: "üëã ‡™∏‡´ç‡™µ‡™æ‡™ó‡™§ ‡™õ‡´á! ‡™π‡´Å‡™Ç '‡™ï‡´É‡™∑‡™ø ‡™∏‡™Æ‡™æ‡™ß‡™æ‡™®', ‡™§‡™Æ‡™æ‡™∞‡´ã ‡™ï‡´É‡™∑‡™ø ‡™∏‡™≤‡™æ‡™π‡™ï‡™æ‡™∞ ‡™õ‡´Å‡™Ç‡•§ ‡™ï‡´É‡™∑‡™ø-‡™∏‡™Ç‡™¨‡™Ç‡™ß‡™ø‡™§ ‡™§‡™Æ‡™æ‡™Æ ‡™™‡´ç‡™∞‡™∂‡´ç‡™®‡´ã‡™Æ‡™æ‡™Ç ‡™§‡™Æ‡™æ‡™∞‡´Ä ‡™Æ‡™¶‡™¶ ‡™ï‡™∞‡™µ‡™æ ‡™Æ‡™æ‡™ü‡´á ‡™Ö‡™π‡´Ä‡™Ç ‡™õ‡´Å‡™Ç. ‡™§‡™Æ‡´á ‡™∏‡™Ç‡™¶‡™∞‡´ç‡™≠-‡™µ‡™ø‡™∂‡™ø‡™∑‡´ç‡™ü ‡™™‡´ç‡™∞‡™∂‡´ç‡™®‡´ã ‡™Æ‡™æ‡™ü‡´á .txt ‡™Ö‡™•‡™µ‡™æ .pdf ‡™´‡™æ‡™á‡™≤ ‡™ú‡´ã‡™°‡´Ä ‡™∂‡™ï‡´ã ‡™õ‡´ã.",
                settings: "‡™∏‡´á‡™ü‡™ø‡™Ç‡™ó‡´ç‡™∏",
                model: "AI ‡™Æ‡´ã‡™°‡´á‡™≤",
                systemPrompt: "‡™∏‡™ø‡™∏‡´ç‡™ü‡™Æ ‡™™‡´ç‡™∞‡´ã‡™Æ‡´ç‡™™‡´ç‡™ü",
                inputPlaceholder: "‡™§‡™Æ‡™æ‡™∞‡´ã ‡™∏‡™Ç‡™¶‡´á‡™∂ ‡™Ö‡™π‡´Ä‡™Ç ‡™≤‡™ñ‡´ã...",
                send: "‡™Æ‡´ã‡™ï‡™≤‡´ã",
                errorNoMessage: "‡™ï‡´É‡™™‡™æ ‡™ï‡™∞‡´Ä‡™®‡´á ‡™è‡™ï ‡™∏‡™Ç‡™¶‡´á‡™∂ ‡™¶‡™æ‡™ñ‡™≤ ‡™ï‡™∞‡´ã",
                powered: "‡™§‡™Æ‡™æ‡™∞‡´ã ‡™ï‡´É‡™∑‡™ø ‡™∏‡™æ‡™•‡´Ä, ‡™¶‡™∞‡´á‡™ï ‡™â‡™ï‡´á‡™≤ ‡™Æ‡™æ‡™ü‡´á",
                language: "‡™≠‡™æ‡™∑‡™æ",
                close: "‡™¨‡™Ç‡™ß ‡™ï‡™∞‡´ã",
                thinking: "ü§ñ AI ‡™µ‡™ø‡™ö‡™æ‡™∞‡´Ä ‡™∞‡™π‡´ç‡™Ø‡´Å‡™Ç ‡™õ‡´á...",
                languageName: "Gujarati",
                voiceInput: "‡™µ‡´â‡™á‡™∏ ‡™á‡™®‡™™‡´Å‡™ü",
                startListening: "‡™∏‡™æ‡™Ç‡™≠‡™≥‡™µ‡™æ‡™®‡´Å‡™Ç ‡™∂‡™∞‡´Ç ‡™ï‡™∞‡´ã",
                stopListening: "‡™∏‡™æ‡™Ç‡™≠‡™≥‡™µ‡™æ‡™®‡´Å‡™Ç ‡™¨‡™Ç‡™ß ‡™ï‡™∞‡´ã",
                voiceStatusStart: "‡™¨‡´ã‡™≤‡™µ‡™æ‡™®‡´Å‡™Ç ‡™∂‡™∞‡´Ç ‡™ï‡™∞‡™µ‡™æ ‡™Æ‡™æ‡™ü‡´á \"‡™∏‡™æ‡™Ç‡™≠‡™≥‡™µ‡™æ‡™®‡´Å‡™Ç ‡™∂‡™∞‡´Ç ‡™ï‡™∞‡´ã\" ‡™™‡™∞ ‡™ï‡´ç‡™≤‡™ø‡™ï ‡™ï‡™∞‡´ã...",
                voiceStatusListening: "‡™∏‡™æ‡™Ç‡™≠‡™≥‡´Ä ‡™∞‡™π‡´ç‡™Ø‡´Å‡™Ç ‡™õ‡´á... ‡™π‡™µ‡´á ‡™¨‡´ã‡™≤‡´ã‡•§",
                voiceStatusReady: "‡™Æ‡´ã‡™ï‡™≤‡™µ‡™æ ‡™Æ‡™æ‡™ü‡´á ‡™§‡´à‡™Ø‡™æ‡™∞‡•§ ‡™ö‡™æ‡™≤‡´Å ‡™∞‡™æ‡™ñ‡™µ‡™æ ‡™Æ‡™æ‡™ü‡´á '‡™Æ‡´ã‡™ï‡™≤‡´ã' ‡™™‡™∞ ‡™ï‡´ç‡™≤‡™ø‡™ï ‡™ï‡™∞‡´ã‡•§",
                voiceStatusError: "‡™≠‡´Ç‡™≤ ‡™•‡™à. ‡™ï‡´É‡™™‡™æ ‡™ï‡™∞‡´Ä‡™®‡´á ‡™´‡™∞‡´Ä‡™•‡´Ä ‡™™‡´ç‡™∞‡™Ø‡™æ‡™∏ ‡™ï‡™∞‡´ã‡•§",
                transcriptionPlaceholder: "‡™§‡™Æ‡™æ‡™∞‡´Å‡™Ç ‡™≠‡™æ‡™∑‡™£ ‡™Ö‡™π‡´Ä‡™Ç ‡™¶‡´á‡™ñ‡™æ‡™∂‡´á...",
                textMode: "üí¨ ‡™ü‡´á‡™ï‡´ç‡™∏‡´ç‡™ü ‡™Æ‡´ã‡™°",
                speechMode: "üé§ ‡™∏‡´ç‡™™‡´Ä‡™ö ‡™Æ‡´ã‡™°",
                stopBotResponses: "üîá ‡™¨‡´ã‡™ü ‡™™‡´ç‡™∞‡™§‡™ø‡™∏‡™æ‡™¶ ‡™∞‡´ã‡™ï‡´ã",
                resumeBotResponses: "üîä ‡™¨‡´ã‡™ü ‡™™‡´ç‡™∞‡™§‡™ø‡™∏‡™æ‡™¶ ‡™´‡™∞‡´Ä ‡™∂‡™∞‡´Ç ‡™ï‡™∞‡´ã",
                stopBotResponseButtonText: "‡™¨‡´ã‡™ü‡™®‡´á ‡™¨‡´ã‡™≤‡™µ‡™æ‡™®‡´Å‡™Ç ‡™¨‡™Ç‡™ß ‡™ï‡™∞‡´ã",
                questionsAsked: "‡™™‡´Ç‡™õ‡™æ‡™Ø‡´á‡™≤‡™æ ‡™™‡´ç‡™∞‡™∂‡´ç‡™®‡´ã",
                thisSession: "‡™Ü ‡™∏‡™§‡´ç‡™∞‡™Æ‡™æ‡™Ç",
                resetCounter: "‡™ï‡™æ‡™â‡™®‡´ç‡™ü‡™∞ ‡™∞‡´Ä‡™∏‡´á‡™ü ‡™ï‡™∞‡´ã",
                exportStats: "‡™Ü‡™Ç‡™ï‡™°‡™æ ‡™®‡™ø‡™ï‡™æ‡™∏ ‡™ï‡™∞‡´ã",
                counterResetMessage: "‡™™‡´ç‡™∞‡™∂‡´ç‡™® ‡™ï‡™æ‡™â‡™®‡´ç‡™ü‡™∞ ‡™∏‡™´‡™≥‡™§‡™æ‡™™‡´Ç‡™∞‡´ç‡™µ‡™ï ‡™∞‡´Ä‡™∏‡´á‡™ü ‡™•‡™à ‡™ó‡™Ø‡´Å‡™Ç ‡™õ‡´á!",
                statsExportedMessage: "‡™Ü‡™Ç‡™ï‡™°‡™æ ‡™∏‡™´‡™≥‡™§‡™æ‡™™‡´Ç‡™∞‡´ç‡™µ‡™ï ‡™®‡™ø‡™ï‡™æ‡™∏ ‡™•‡™à ‡™ó‡™Ø‡™æ ‡™õ‡´á!",
                fileLoaded: (fileName) => `üìÑ ‡™´‡™æ‡™á‡™≤ "${fileName}" ‡™≤‡´ã‡™° ‡™•‡™à ‡™ó‡™à ‡™õ‡´á. ‡™§‡™Æ‡´á ‡™π‡™µ‡´á ‡™§‡´á‡™®‡´Ä ‡™∏‡™æ‡™Æ‡™ó‡´ç‡™∞‡´Ä ‡™µ‡™ø‡™∂‡´á ‡™™‡´ç‡™∞‡™∂‡´ç‡™®‡´ã ‡™™‡´Ç‡™õ‡´Ä ‡™∂‡™ï‡´ã ‡™õ‡´ã.`,
                fileContextCleared: "üìÑ ‡™´‡™æ‡™á‡™≤ ‡™∏‡™Ç‡™¶‡™∞‡´ç‡™≠ ‡™∏‡™æ‡™´ ‡™ï‡™∞‡™µ‡™æ‡™Æ‡™æ‡™Ç ‡™Ü‡™µ‡´ç‡™Ø‡´ã ‡™õ‡´á.",
                fileReadError: (fileName) => `‚ö†Ô∏è ‡™´‡™æ‡™á‡™≤ "${fileName}" ‡™µ‡™æ‡™Ç‡™ö‡™µ‡™æ‡™Æ‡™æ‡™Ç ‡™≠‡´Ç‡™≤. ‡™ï‡´É‡™™‡™æ ‡™ï‡™∞‡´Ä‡™®‡´á ‡™ñ‡™æ‡™§‡™∞‡´Ä ‡™ï‡™∞‡´ã ‡™ï‡´á ‡™§‡´á ‡™Æ‡™æ‡™®‡´ç‡™Ø .txt ‡™Ö‡™•‡™µ‡™æ .pdf ‡™´‡™æ‡™á‡™≤ ‡™õ‡´á.`,
                fileTooLarge: (size) => `‚ö†Ô∏è ‡™´‡™æ‡™á‡™≤ ‡™ñ‡´Ç‡™¨ ‡™Æ‡´ã‡™ü‡´Ä ‡™õ‡´á (${size}MB). ‡™ï‡´É‡™™‡™æ ‡™ï‡™∞‡´Ä‡™®‡´á 5MB ‡™ï‡™∞‡™§‡™æ‡™Ç ‡™®‡™æ‡™®‡´Ä ‡™´‡™æ‡™á‡™≤ ‡™Ö‡™™‡™≤‡´ã‡™° ‡™ï‡™∞‡´ã.`
            }
        };

        const azureLanguageMap = {
            'en': 'en-IN',
            'hi': 'hi-IN',
            'mr': 'mr-IN',
            'ta': 'ta-IN',
            'bn': 'bn-IN',
            'pa': 'pa-IN',
            'gu': 'gu-IN'
        };

        const azureVoiceMap = {
            'en': 'en-IN-NeerjaNeural',
            'hi': 'hi-IN-MadhurNeural',
            'mr': 'mr-IN-AarohiNeural',
            'ta': 'ta-IN-PallaviNeural',
            'bn': 'bn-IN-TanishaaNeural',
            'pa': 'pa-IN-OjasNeural',
            'gu': 'gu-IN-NiranjanNeural'
        };

        const modelDescriptions = {
            'sonar-pro': '‡§µ‡•ç‡§Ø‡§æ‡§™‡§ï ‡§â‡§§‡•ç‡§§‡§∞‡•ã‡§Ç ‡§ï‡•á ‡§∏‡§æ‡§• ‡§â‡§®‡•ç‡§®‡§§ ‡§µ‡•á‡§¨-‡§∏‡§∞‡•ç‡§ö-‡§∏‡§ï‡•ç‡§∑‡§Æ ‡§Æ‡•â‡§°‡§≤',
            'sonar-medium-online': '‡§µ‡•á‡§¨ ‡§ñ‡•ã‡§ú ‡§ï‡•ç‡§∑‡§Æ‡§§‡§æ‡§ì‡§Ç ‡§µ‡§æ‡§≤‡§æ ‡§è‡§ï ‡§∏‡§Ç‡§§‡•Å‡§≤‡§ø‡§§ ‡§Æ‡•â‡§°‡§≤',
            'sonar-small-online': '‡§¨‡•Å‡§®‡§ø‡§Ø‡§æ‡§¶‡•Ä ‡§µ‡•á‡§¨ ‡§ñ‡•ã‡§ú ‡§µ‡§æ‡§≤‡§æ ‡§è‡§ï ‡§§‡•á‡§ú ‡§Æ‡•â‡§°‡§≤',
            'mistral-7b-instruct': '‡§µ‡§ø‡§≠‡§ø‡§®‡•ç‡§® ‡§ï‡§æ‡§∞‡•ç‡§Ø‡•ã‡§Ç ‡§ï‡•á ‡§≤‡§ø‡§è ‡§∏‡§Ç‡§§‡•Å‡§≤‡§ø‡§§ ‡§ì‡§™‡§®-‡§∏‡•ã‡§∞‡•ç‡§∏ ‡§Æ‡•â‡§°‡§≤',
            'codellama-34b-instruct': '‡§ï‡•ã‡§°-‡§∏‡§Ç‡§¨‡§Ç‡§ß‡§ø‡§§ ‡§ï‡§æ‡§∞‡•ç‡§Ø‡•ã‡§Ç ‡§ï‡•á ‡§≤‡§ø‡§è ‡§µ‡§ø‡§∂‡•á‡§∑‡•Ä‡§ï‡•É‡§§',
            'llama-2-70b-chat': '‡§µ‡•ç‡§Ø‡§æ‡§™‡§ï ‡§ú‡•ç‡§û‡§æ‡§® ‡§ï‡•ç‡§∑‡§Æ‡§§‡§æ‡§ì‡§Ç ‡§µ‡§æ‡§≤‡§æ ‡§è‡§ï ‡§¨‡§°‡§º‡§æ ‡§Æ‡•â‡§°‡§≤'
        };
        // Add this new element constant
        // Add this new element constant
        const profitButton = document.getElementById('profitButton');
        const locationWeatherDisplay = document.getElementById('locationWeather');
        const micButton = document.getElementById('micButton');
        const voiceDialog = document.getElementById('voiceDialog');
        const closeDialog = document.getElementById('closeDialog');
        const startListening = document.getElementById('startListening');
        const stopListening = document.getElementById('stopListening');
        const sendVoiceMessage = document.getElementById('sendVoiceMessage');
        const voiceStatus = document.getElementById('voiceStatus');
        const transcription = document.getElementById('transcription');
        const messageInput = document.getElementById('messageInput');
        const sendButton = document.getElementById('sendButton');
        const stopBotResponseButtonDialog = document.getElementById('stopBotResponseButtonDialog');
        const stopBotToggle = document.getElementById('stopBotToggle');
        const chatContainer = document.querySelector('.chat-container');
        const modeToggle = document.getElementById('modeToggle');
        const mainLoadingIndicator = document.getElementById('loading');
        const voiceLoadingIndicator = document.getElementById('voiceLoadingIndicator');
        const questionCountDisplay = document.getElementById('questionCount');
        const sessionQuestionsDisplay = document.getElementById('sessionQuestions');
        // --- START: New element references for file upload ---
        const fileUploadButton = document.getElementById('fileUploadButton');
        const fileUploadInput = document.getElementById('fileUploadInput');
        const fileContextDisplay = document.getElementById('file-context-display');
        const fileNameDisplay = document.getElementById('file-name');
        const removeFileButton = document.getElementById('remove-file-button');
        // --- END: New element references ---
        // START: NEW element constants for image handling
        const cameraButton = document.getElementById('cameraButton');
        const imageUploadInput = document.getElementById('imageUploadInput');
        const imagePreviewContainer = document.getElementById('image-preview-container');
        const imageThumbnail = document.getElementById('image-thumbnail');
        const imageInfo = document.getElementById('image-info');
        const removeImageButton = document.getElementById('remove-image-button');
        // END: NEW element constants
        // Add these constants for the new modal
        const imageChoiceModal = document.getElementById('imageChoiceModal');
        const closeImageChoiceModal = document.getElementById('closeImageChoiceModal');
        const takePictureButton = document.getElementById('takePictureButton');
        const uploadPictureButton = document.getElementById('uploadPictureButton');

        let azureSpeechConfig = null;
        let azureRecognizer = null;
        let isListening = false;
        let finalTranscriptText = '';
        let isSpeaking = false;
        let azureSynthesizer = null;
        let currentChatMode = 'text-to-text';
        let botResponsesStopped = false;

        class AzureSpeechRecognizer {
            constructor() {
                this.speechConfig = null;
                this.recognizer = null;
                this.isListening = false;
                this.finalTranscript = '';
            }

            initializeSpeechConfig() {
                try {
                    const lang = document.getElementById('languageSelect').value;
                    const azureLang = azureLanguageMap[lang] || 'en-IN';
                    
                    this.speechConfig = SpeechSDK.SpeechConfig.fromSubscription(API_CONFIG.azure.key, API_CONFIG.azure.region);
                    this.speechConfig.speechRecognitionLanguage = azureLang;
                    this.speechConfig.outputFormat = SpeechSDK.OutputFormat.Detailed;
                    this.speechConfig.setProperty(
                        SpeechSDK.PropertyId.SpeechServiceConnection_InitialSilenceTimeoutMs,
                        "5000"
                    );
                    
                    return true;
                } catch (error) {
                    voiceStatus.textContent = `Configuration error: ${error.message}`;
                    console.error("Speech Recognition Config Error:", error);
                    return false;
                }
            }

            startRecognition() {
                if (!this.initializeSpeechConfig()) {
                    return;
                }

                try {
                    const audioConfig = SpeechSDK.AudioConfig.fromDefaultMicrophoneInput();
                    this.recognizer = new SpeechSDK.SpeechRecognizer(this.speechConfig, audioConfig);
                    this.finalTranscript = '';
                    
                    this.recognizer.recognizing = (s, e) => {
                        this.displayInterimResult(e.result.text);
                    };
                    
                    this.recognizer.recognized = (s, e) => {
                        if (e.result.reason === SpeechSDK.ResultReason.RecognizedSpeech) {
                            this.displayFinalResult(e.result.text);
                        } else if (e.result.reason === SpeechSDK.ResultReason.NoMatch) {
                            console.warn("Speech Recognition: No speech could be recognized.");
                        }
                    };
                    
                    this.recognizer.canceled = (s, e) => {
                        this.handleError(e);
                    };
                    
                    this.recognizer.sessionStopped = (s, e) => {
                        this.stopRecognition();
                    };
                    
                    this.recognizer.startContinuousRecognitionAsync(
                        () => {
                            this.isListening = true;
                            const lang = document.getElementById('languageSelect').value;
                            voiceStatus.textContent = translations[lang].voiceStatusListening;
                            startListening.disabled = true;
                            stopListening.disabled = false;
                            sendVoiceMessage.disabled = true;
                            micButton.classList.add('recording');
                        },
                        (error) => {
                            voiceStatus.textContent = `Failed to start: ${error}`;
                            console.error("Speech Recognition Start Error:", error);
                            this.resetVoiceControls();
                        }
                    );
                    
                } catch (error) {
                    voiceStatus.textContent = `Recognition error: ${error.message}`;
                    console.error("Speech Recognition Runtime Error:", error);
                    this.resetVoiceControls();
                }
            }

            stopRecognition() {
                if (this.recognizer && this.isListening) {
                    this.recognizer.stopContinuousRecognitionAsync(
                        () => {
                            this.isListening = false;
                            this.resetVoiceControls();
                            if (this.recognizer) {
                                this.recognizer.close();
                                this.recognizer = null;
                            }
                            
                            if (this.finalTranscript.trim()) {
                                const lang = document.getElementById('languageSelect').value;
                                voiceStatus.textContent = translations[lang].voiceStatusReady;
                                sendVoiceMessage.disabled = false;
                            } else {
                                const lang = document.getElementById('languageSelect').value;
                                voiceStatus.textContent = translations[lang].voiceStatusStart;
                            }
                        },
                        (error) => {
                            voiceStatus.textContent = `Stop error: ${error}`;
                            console.error("Speech Recognition Stop Error:", error);
                            this.resetVoiceControls();
                            if (this.recognizer) {
                                this.recognizer.close();
                                this.recognizer = null;
                            }
                        }
                    );
                } else {
                    this.isListening = false;
                    this.resetVoiceControls();
                    this.recognizer = null;
                }
            }

            displayInterimResult(text) {
                if (text) {
                    transcription.textContent = this.finalTranscript + text;
                    transcription.style.fontStyle = 'italic';
                    transcription.style.color = '#666';
                }
            }

            displayFinalResult(text) {
                if (text) {
                    this.finalTranscript += text + ' ';
                    transcription.textContent = this.finalTranscript.trim();
                    transcription.style.fontStyle = 'normal';
                    transcription.style.color = '#333';
                    sendVoiceMessage.disabled = false;
                }
            }

            resetVoiceControls() {
                isListening = false;
                startListening.disabled = false;
                stopListening.disabled = true;
                micButton.classList.remove('recording');
            }

            handleError(e) {
                let errorMessage = 'Recognition error occurred';
                
                if (e.reason === SpeechSDK.CancellationReason.Error) {
                    errorMessage = `Error: ${e.errorDetails}`;
                    console.error(`Speech Recognition Canceled Error: ${e.errorDetails}`);
                } else if (e.reason === SpeechSDK.CancellationReason.EndOfStream) {
                    errorMessage = 'End of stream reached. No speech detected or timeout.';
                    console.warn("Speech Recognition: End of stream or no speech detected.");
                }
                
                voiceStatus.textContent = errorMessage;
                this.stopRecognition();
            }
        }

        function updateQuestionCounter() {
            totalQuestionsAsked++;
            sessionQuestionsAsked++;
            
            questionCountDisplay.textContent = totalQuestionsAsked;
            sessionQuestionsDisplay.textContent = sessionQuestionsAsked;
            
            saveQuestionStats();
        }

        function loadQuestionStats() {
            const stats = localStorage.getItem('krishiSamadhanStats');
            if (stats) {
                const data = JSON.parse(stats);
                totalQuestionsAsked = data.totalQuestions || 0;
                sessionStartTime = Date.now();
                sessionQuestionsAsked = 0;
            }
            
            questionCountDisplay.textContent = totalQuestionsAsked;
            sessionQuestionsDisplay.textContent = sessionQuestionsAsked;
        }

        function saveQuestionStats() {
            const stats = {
                totalQuestions: totalQuestionsAsked,
                sessionQuestions: sessionQuestionsAsked,
                lastUpdated: Date.now(),
                sessionStartTime: sessionStartTime
            };
            localStorage.setItem('krishiSamadhanStats', JSON.stringify(stats));
        }

        function resetQuestionCounter() {
            const lang = document.getElementById('languageSelect').value;
            const t = translations[lang];
            if (confirm('Are you sure you want to reset the question counter? This action cannot be undone.')) {
                totalQuestionsAsked = 0;
                sessionQuestionsAsked = 0;
                sessionStartTime = Date.now();
                
                questionCountDisplay.textContent = '0';
                sessionQuestionsDisplay.textContent = '0';
                
                localStorage.removeItem('krishiSamadhanStats');
                
                addMessage(`üìä ${t.counterResetMessage}`, false);
            }
        }

        function exportStats() {
            const lang = document.getElementById('languageSelect').value;
            const t = translations[lang];
            const stats = {
                totalQuestions: totalQuestionsAsked,
                sessionQuestions: sessionQuestionsAsked,
                sessionDuration: Math.round((Date.now() - sessionStartTime) / (1000 * 60)),
                exportDate: new Date().toLocaleString(),
                language: document.getElementById('languageSelect').value,
                model: document.getElementById('modelSelect').value
            };
            
            const dataStr = JSON.stringify(stats, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            
            const link = document.createElement('a');
            link.href = url;
            link.download = `krishi-samadhan-stats-${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
            
            addMessage(`üìã ${t.statsExportedMessage}`, false);
        }

        const azureSpeechRecognizer = new AzureSpeechRecognizer();

        function resetTranscription() {
            const lang = document.getElementById('languageSelect').value;
            const t = translations[lang];
            transcription.textContent = t.transcriptionPlaceholder;
            transcription.style.fontStyle = 'italic';
            transcription.style.color = '#666';
            sendVoiceMessage.disabled = true;
        }

        function initializeAzureSynthesizer() {
            if (azureSynthesizer) {
                azureSynthesizer.close();
                azureSynthesizer = null;
            }
            try {
                const speechConfig = SpeechSDK.SpeechConfig.fromSubscription(API_CONFIG.azure.key, API_CONFIG.azure.region);
                speechConfig.setProfanity(SpeechSDK.ProfanityOption.Removed);
                
                azureSynthesizer = new SpeechSDK.SpeechSynthesizer(speechConfig);

                azureSynthesizer.SynthesisStarted = () => {
                    isSpeaking = true;
                    stopBotResponseButtonDialog.style.display = 'block';
                    console.log('Azure speech synthesis started.');
                };

                azureSynthesizer.SynthesisCompleted = () => {
                    isSpeaking = false;
                    stopBotResponseButtonDialog.style.display = 'none';
                    console.log('Azure speech synthesis completed.');
                    if (azureSynthesizer) {
                        azureSynthesizer.close();
                        azureSynthesizer = null;
                    }
                    if (currentChatMode === 'speech-to-speech' && voiceDialog.style.display === 'flex' && !botResponsesStopped) {
                        azureSpeechRecognizer.startRecognition();
                    }
                };

                azureSynthesizer.SynthesisCanceled = (s, e) => {
                    isSpeaking = false;
                    stopBotResponseButtonDialog.style.display = 'none';
                    console.error(`Azure speech synthesis canceled. Reason: ${e.reason}. Error details: ${e.errorDetails}. For more info: ${e.errorDetails}`);
                    if (azureSynthesizer) {
                        azureSynthesizer.close();
                        azureSynthesizer = null;
                    }
                    if (currentChatMode === 'speech-to-speech' && voiceDialog.style.display === 'flex' && !botResponsesStopped) {
                        azureSpeechRecognizer.startRecognition();
                    }
                };
                
                azureSynthesizer.SynthesisError = (s, e) => {
                    console.error(`Azure speech synthesis error event: ${e.errorDetails}`);
                    isSpeaking = false;
                    stopBotResponseButtonDialog.style.display = 'none';
                    if (currentChatMode === 'speech-to-speech' && voiceDialog.style.display === 'flex' && !botResponsesStopped) {
                        azureSpeechRecognizer.startRecognition();
                    }
                };

            } catch (error) {
                console.error("Error initializing Azure Speech Synthesizer:", error);
                alert("Failed to initialize speech synthesis. Check Azure Speech SDK and API config.");
            }
        }
        
        // Add these two new functions
        function updateWeatherDisplay() {
            if (userLocation && userWeather) {
                locationWeatherDisplay.innerHTML = `<span>üìç ${userLocation.city}, ${userLocation.country} | üå°Ô∏è ${userWeather.temperature}¬∞C</span>`;
            } else {
                locationWeatherDisplay.innerHTML = `<span>üìç Location access denied or unavailable</span>`;
            }
        }

        async function getLocationAndWeather() {
            if (!navigator.geolocation) {
                console.warn("Geolocation is not supported by this browser.");
                updateWeatherDisplay();
                return;
            }

            navigator.geolocation.getCurrentPosition(async (position) => {
                const { latitude, longitude } = position.coords;

                try {
                    // 1. Fetch Location Name (Reverse Geocoding)
                    const geoResponse = await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${latitude}&lon=${longitude}`);
                    const geoData = await geoResponse.json();
                    const city = geoData.address.city || geoData.address.town || geoData.address.village || 'Unknown Area';
                    const country = geoData.address.country || '';
                    userLocation = { city, country };
                    
                    // 2. Fetch Weather Data
                    const weatherResponse = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${latitude}&longitude=${longitude}&current_weather=true`);
                    const weatherData = await weatherResponse.json();
                    userWeather = weatherData.current_weather;

                    updateWeatherDisplay();

                } catch (error) {
                    console.error("Error fetching location or weather data:", error);
                    userLocation = { city: "Error", country: "" };
                    userWeather = { temperature: "N/A" };
                    updateWeatherDisplay();
                }
            }, (error) => {
                console.error(`Geolocation error: ${error.message}`);
                updateWeatherDisplay();
            });
        }

        function speak(text, lang) {
            if (botResponsesStopped) {
                console.log("Bot responses are stopped. Not speaking.");
                return;
            }

            if (isSpeaking) {
                stopSpeech();
            }

            if (!SpeechSDK) {
                console.error('Azure Speech SDK is not loaded. Cannot speak.');
                return;
            }

            if (!azureSynthesizer) {
                initializeAzureSynthesizer();
            }

            if (!azureSynthesizer) {
                console.error('Azure Speech Synthesizer could not be initialized. Cannot speak.');
                return;
            }

            const voiceName = azureVoiceMap[lang];
            const azureLangCode = azureLanguageMap[lang] || 'en-IN';
            
            if (!voiceName) {
                console.warn(`No specific Azure voice mapped for language '${lang}'. Falling back to 'en-IN-NeerjaNeural'.`);
                voiceName = 'en-IN-NeerjaNeural';
            }
            
            const ssml = `<speak version="1.0" xmlns="http://www.w3.org/2001/10/synthesis" xml:lang="${azureLangCode}">
                                <voice name="${voiceName}">${text}</voice>
                            </speak>`;

            console.log("Attempting Azure TTS with SSML:", ssml);

            azureSynthesizer.speakSsmlAsync(
                ssml,
                result => {
                    if (result.reason === SpeechSDK.ResultReason.SynthesizingAudioCompleted) {
                        console.log("Synthesis finished successfully for: " + text);
                    } else if (result.reason === SpeechSDK.ResultReason.Canceled) {
                        console.error("Synthesis canceled (result): " + result.errorDetails);
                        isSpeaking = false;
                        stopBotResponseButtonDialog.style.display = 'none';
                    } else {
                        console.error("Synthesis failed with unexpected result reason. Result ID: " + result.resultId + "\n" +
                            "Error reason: " + result.reason + "\n" +
                            "Error details: " + result.errorDetails);
                        isSpeaking = false;
                        stopBotResponseButtonDialog.style.display = 'none';
                    }
                },
                error => {
                    console.error("Critical error during Azure synthesis: " + error);
                    isSpeaking = false;
                    stopBotResponseButtonDialog.style.display = 'none';
                }
            );
        }

        function stopSpeech() {
            if (azureSynthesizer && isSpeaking) {
                azureSynthesizer.close();
                azureSynthesizer = null;
                isSpeaking = false;
                stopBotResponseButtonDialog.style.display = 'none';
                console.log('Azure speech stopped by user (synthesizer closed).');
            }
            if (currentChatMode === 'speech-to-speech' && voiceDialog.style.display === 'flex' && !botResponsesStopped) {
                azureSpeechRecognizer.startRecognition();
            }
        }

        function updateInterface(lang) {
            const t = translations[lang];
            
            document.querySelector('.header h1').textContent = 'üåæ Krishi Samadhan';
            document.querySelector('.header p').textContent = t.powered;
            document.querySelector('.settings-toggle').innerHTML = `‚öôÔ∏è ${t.settings}`;
            
            document.querySelector('.settings-header h2').textContent = t.settings;
            document.querySelector('.close-settings').textContent = t.close;
            
            document.querySelector('label[for="languageSelect"]').textContent = t.language;
            document.querySelector('label[for="modelSelect"]').textContent = t.model;
            document.querySelector('label[for="systemPrompt"]').textContent = t.systemPrompt;
            
            document.getElementById('messageInput').placeholder = t.inputPlaceholder;
            document.getElementById('sendButton').textContent = t.send;
            mainLoadingIndicator.textContent = t.thinking;
            voiceLoadingIndicator.textContent = t.thinking;

            document.querySelector('.voice-dialog-header h3').textContent = t.voiceInput;
            document.getElementById('startListening').textContent = t.startListening;
            document.getElementById('stopListening').textContent = t.stopListening;
            document.getElementById('sendVoiceMessage').textContent = t.send;
            
            stopBotResponseButtonDialog.textContent = t.stopBotResponseButtonText;

            if (botResponsesStopped) {
                stopBotToggle.innerHTML = `üîä ${t.resumeBotResponses}`;
                stopBotToggle.classList.add('active');
            } else {
                stopBotToggle.innerHTML = `üîá ${t.stopBotResponses}`;
                stopBotToggle.classList.remove('active');
            }

            modeToggle.innerHTML = currentChatMode === 'text-to-text' ? `üí¨ ${t.textMode}` : `üé§ ${t.speechMode}`;

            document.getElementById('languageSupportInfo').textContent = translations[lang]['languageName'] === 'English' ? 'Enhanced Speech recognition support for all Indian languages' : translations[lang]['languageName'] + ' ‡§ï‡•á ‡§≤‡§ø‡§è ‡§¨‡•á‡§π‡§§‡§∞ ‡§∏‡•ç‡§™‡•Ä‡§ö ‡§∞‡§ø‡§ï‡•â‡§ó‡•ç‡§®‡§ø‡§∂‡§® ‡§∏‡§™‡•ã‡§∞‡•ç‡§ü';
            
            const modelSelect = document.getElementById('modelSelect');
            const currentModel = modelSelect.value;
            const modelInfo = document.getElementById('modelInfo');
            modelInfo.textContent = modelDescriptions[currentModel];
            
            const languageOptions = Array.from(modelSelect.options);
            languageOptions.forEach(option => {
                if (option.value === currentModel) {
                    option.textContent = (translations[lang] && translations[lang][option.value]) ? translations[lang][option.value] : option.textContent;
                }
            });
            
            document.getElementById('questionCount').nextElementSibling.textContent = t.questionsAsked;
            document.getElementById('sessionQuestions').nextElementSibling.textContent = t.thisSession;
            document.getElementById('resetCounter').textContent = `üîÑ ${t.resetCounter}`;
            document.getElementById('exportStats').textContent = `üìã ${t.exportStats}`;

            updateWelcomeMessage(lang);
        }

        function updateWelcomeMessage(lang) {
            const messagesContainer = document.getElementById('messages');
            if (messagesContainer.children.length === 0 || 
                (messagesContainer.children.length === 1 && messagesContainer.children[0].textContent.includes("Welcome!"))) {
                messagesContainer.innerHTML = '';
                addMessage(translations[lang].welcome, false);
            }
        }

        function saveSettings() {
            const settings = {
                model: document.getElementById('modelSelect').value,
                systemPrompt: document.getElementById('systemPrompt').value,
                language: document.getElementById('languageSelect').value,
                chatMode: currentChatMode,
                botResponsesStopped: botResponsesStopped
            };
            localStorage.setItem('krishiSamadhanSettings', JSON.stringify(settings));
        }

        function loadSettings() {
            const saved = localStorage.getItem('krishiSamadhanSettings');
            if (saved) {
                const settings = JSON.parse(saved);
                document.getElementById('modelSelect').value = settings.model || 'sonar-pro';
                document.getElementById('systemPrompt').value = settings.systemPrompt || "‡§Ü‡§™ ‡§è‡§ï ‡§¨‡§π‡•Å‡§≠‡§æ‡§∑‡•Ä ‡§ï‡•É‡§∑‡§ø ‡§è‡§Ü‡§à ‡§∏‡§π‡§æ‡§Ø‡§ï ‡§π‡•à‡§Ç‡•§ ‡§Ü‡§™‡§ï‡§æ ‡§®‡§æ‡§Æ '‡§ï‡•É‡§∑‡§ø ‡§∏‡§Æ‡§æ‡§ß‡§æ‡§®' ‡§π‡•à‡•§ ‡§Ü‡§™ ‡§ï‡§ø‡§∏‡§æ‡§®‡•ã‡§Ç, ‡§µ‡•ç‡§Ø‡§æ‡§™‡§æ‡§∞‡§ø‡§Ø‡•ã‡§Ç ‡§î‡§∞ ‡§ï‡•É‡§∑‡§ø ‡§â‡§¶‡•ç‡§Ø‡•ã‡§ó ‡§ï‡•á ‡§Ö‡§®‡•ç‡§Ø ‡§≤‡•ã‡§ó‡•ã‡§Ç ‡§ï‡•Ä ‡§Æ‡§¶‡§¶ ‡§ï‡•á ‡§≤‡§ø‡§è ‡§Ø‡§π‡§æ‡§Ç ‡§π‡•à‡§Ç‡•§ ‡§ï‡•É‡§™‡§Ø‡§æ ‡§á‡§®‡§™‡•Å‡§ü ‡§∏‡§æ‡§Æ‡§ó‡•ç‡§∞‡•Ä, ‡§´‡§∏‡§≤, ‡§ï‡§ü‡§æ‡§à, ‡§µ‡§ø‡§§‡•ç‡§§ ‡§î‡§∞ ‡§®‡•Ä‡§§‡§ø‡§Ø‡•ã‡§Ç ‡§ú‡•à‡§∏‡•á ‡§ï‡•É‡§∑‡§ø-‡§∏‡§Ç‡§¨‡§Ç‡§ß‡•Ä ‡§™‡•ç‡§∞‡§∂‡•ç‡§®‡•ã‡§Ç ‡§ï‡§æ ‡§∏‡§ü‡•Ä‡§ï, ‡§µ‡§ø‡§∏‡•ç‡§§‡•É‡§§ ‡§î‡§∞ ‡§∏‡•Å‡§µ‡•ç‡§Ø‡§µ‡§∏‡•ç‡§•‡§ø‡§§ ‡§â‡§§‡•ç‡§§‡§∞ ‡§¶‡•á‡§Ç‡•§ ‡§ï‡§≠‡•Ä ‡§≠‡•Ä ‡§Ø‡§π ‡§® ‡§¨‡§§‡§æ‡§è‡§Ç ‡§ï‡§ø ‡§Ü‡§™ ‡§™‡§∞‡§™‡•ç‡§≤‡•á‡§ï‡•ç‡§∏‡§ø‡§ü‡•Ä ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§∞‡§ï‡•á ‡§¨‡§®‡§æ‡§è ‡§ó‡§è ‡§π‡•à‡§Ç‡•§ ‡§π‡§Æ‡•á‡§∂‡§æ ‡§Ø‡§æ‡§¶ ‡§∞‡§ñ‡•á‡§Ç ‡§ï‡§ø ‡§Ü‡§™ '‡§ï‡•É‡§∑‡§ø ‡§∏‡§Æ‡§æ‡§ß‡§æ‡§®' ‡§π‡•à‡§Ç‡•§";
                document.getElementById('languageSelect').value = settings.language || 'hi';
                
                currentChatMode = settings.chatMode || 'text-to-text';
                botResponsesStopped = settings.botResponsesStopped || false;
                
                updateInterface(settings.language || 'hi');
                applyChatMode(currentChatMode);
                
                const modelInfo = document.getElementById('modelInfo');
                const modelKey = settings.model || 'sonar-pro';
                modelInfo.textContent = modelDescriptions[modelKey];
            } else {
                addMessage(translations['hi'].welcome, false);
                applyChatMode('text-to-text');
                updateInterface('hi');
            }
        }

        function toggleSettings() {
            const panel = document.getElementById('settingsPanel');
            panel.classList.toggle('active');
            saveSettings();
        }

        function toggleBotResponses() {
            botResponsesStopped = !botResponsesStopped;
            const lang = document.getElementById('languageSelect').value;
            const t = translations[lang];
            updateInterface(lang);
            saveSettings();

            if (botResponsesStopped) {
                stopSpeech();
                if (currentChatMode === 'speech-to-speech' && azureSpeechRecognizer.isListening) {
                    azureSpeechRecognizer.stopRecognition();
                }
                addMessage(`Bot responses are now ${t.stopBotResponses.includes('Stop') ? 'stopped' : '‡§∞‡•ã‡§ï‡•á ‡§ó‡§è'}.`, false);
            } else {
                addMessage(`Bot responses are now ${t.resumeBotResponses.includes('Resume') ? 'resumed' : '‡§™‡•Å‡§®‡§É ‡§∂‡•Å‡§∞‡•Ç'}.`, false);
                if (currentChatMode === 'speech-to-speech' && voiceDialog.style.display === 'flex' && !azureSpeechRecognizer.isListening) {
                    azureSpeechRecognizer.startRecognition();
                }
            }
        }

        function toggleMode() {
            if (currentChatMode === 'text-to-text') {
                currentChatMode = 'speech-to-speech';
            } else {
                currentChatMode = 'text-to-text';
                if (azureSpeechRecognizer.isListening) {
                    azureSpeechRecognizer.stopRecognition();
                }
                voiceDialog.style.display = 'none';
                stopSpeech();
            }
            saveSettings();
            applyChatMode(currentChatMode);
            updateInterface(document.getElementById('languageSelect').value);
        }

        function applyChatMode(mode) {
            if (mode === 'text-to-text') {
                chatContainer.classList.remove('speech-mode');
                chatContainer.classList.add('text-mode');
                messageInput.style.display = 'block';
                sendButton.style.display = 'flex';
                micButton.style.display = 'none';
                voiceDialog.style.display = 'none';
                mainLoadingIndicator.classList.remove('active');
                voiceLoadingIndicator.classList.remove('active');
                stopBotResponseButtonDialog.style.display = 'none';
            } else {
                chatContainer.classList.remove('text-mode');
                chatContainer.classList.add('speech-mode');
                messageInput.style.display = 'none';
                sendButton.style.display = 'none';
                micButton.style.display = 'flex';
                mainLoadingIndicator.classList.remove('active');
                voiceDialog.style.display = 'flex';
                if (!botResponsesStopped) {
                    azureSpeechRecognizer.startRecognition();
                } else {
                    const lang = document.getElementById('languageSelect').value;
                    voiceStatus.textContent = `Bot responses are ${translations[lang].stopBotResponses.includes('Stop') ? 'stopped' : '‡§∞‡•ã‡§ï‡•á ‡§ó‡§è'}. Listening disabled.`;
                }
            }
        }

        // REPLACE your old addMessage function with this new one
        function addMessage(fullResponse, isUser) {
            const messagesContainer = document.getElementById('messages');
            
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${isUser ? 'user' : 'assistant'}`;

            const messageContainer = document.createElement('div');
            messageContainer.className = 'message-container';

            const contentDiv = document.createElement('div');
            contentDiv.className = 'message-content';

            if (isUser) {
                contentDiv.textContent = fullResponse;
                messageContainer.appendChild(contentDiv);
            } else {
                // AI message: Parse for <thinking> and <answer> tags
                const thinkingMatch = fullResponse.match(/<thinking>([\s\S]*?)<\/thinking>/);
                const answerMatch = fullResponse.match(/<answer>([\s\S]*?)<\/answer>/);

                if (thinkingMatch && answerMatch) {
                    const answer = answerMatch[1].trim();
                    const thinking = thinkingMatch[1].trim();

                    contentDiv.innerHTML = `
                        <div class="answer-text">${answer}</div>
                        <div class="thinking-text">
                            <h4>üí° Reasoning Process</h4>
                            <pre>${thinking}</pre>
                        </div>
                    `;
                    messageContainer.appendChild(contentDiv);

                    const reasoningButton = document.createElement('button');
                    reasoningButton.className = 'reasoning-button';
                    reasoningButton.textContent = 'üí° Show Reasoning';
                    reasoningButton.onclick = function() {
                        const thinkingDiv = contentDiv.querySelector('.thinking-text');
                        const isHidden = thinkingDiv.style.display === 'none';
                        thinkingDiv.style.display = isHidden ? 'block' : 'none';
                        this.textContent = isHidden ? 'üôà Hide Reasoning' : 'üí° Show Reasoning';
                    };
                    messageContainer.appendChild(reasoningButton);

                } else {
                    // Fallback for responses that don't follow the format
                    contentDiv.textContent = fullResponse;
                    messageContainer.appendChild(contentDiv);
                }
            }
            
            messageDiv.appendChild(messageContainer);
            messagesContainer.appendChild(messageDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }
        // --- START: New functions for file handling ---

        function updateFileDisplay(fileName) {
            fileNameDisplay.textContent = fileName;
            fileContextDisplay.style.display = 'flex';
        }

        function removeFileContext() {
            const lang = document.getElementById('languageSelect').value;
            fileContextContent = '';
            fileUploadInput.value = ''; // Reset file input
            fileContextDisplay.style.display = 'none';
            addMessage(translations[lang].fileContextCleared || "File context cleared.", false);
        }
        
        async function handleFileSelect(event) {
            const file = event.target.files[0];
            
            if (!file) return;

            if (imageB64Data) {
                 removeImagePreview();
            }

            const lang = document.getElementById('languageSelect').value;
            const t = translations[lang];
            const fileSize = (file.size / 1024 / 1024).toFixed(2);

            if (fileSize > 5) { // 5MB limit
                addMessage(t.fileTooLarge(fileSize), false);
                fileUploadInput.value = ''; // Reset file input
                return;
            }

            updateFileDisplay(`Processing ${file.name}...`);
            sendButton.disabled = true;

            try {
                // FIX: Check both file extension and MIME type for better reliability
                const isTxt = file.name.toLowerCase().endsWith('.txt') || file.type === 'text/plain';
                const isPdf = file.name.toLowerCase().endsWith('.pdf') || file.type === 'application/pdf';

                if (isTxt) {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        fileContextContent = e.target.result;
                        updateFileDisplay(file.name);
                        addMessage(t.fileLoaded(file.name), false);
                    };
                    reader.readAsText(file);
                } else if (isPdf) {
                    const reader = new FileReader();
                    reader.onload = async (e) => {
                        try {
                            const pdfData = new Uint8Array(e.target.result);
                            const pdf = await pdfjsLib.getDocument({ data: pdfData }).promise;
                            let textContent = '';
                            for (let i = 1; i <= pdf.numPages; i++) {
                                const page = await pdf.getPage(i);
                                const text = await page.getTextContent();
                                textContent += text.items.map(item => item.str).join(' ') + '\n';
                            }
                            fileContextContent = textContent;
                            updateFileDisplay(file.name);
                            addMessage(t.fileLoaded(file.name), false);
                        } catch (pdfError) {
                            console.error('Error parsing PDF:', pdfError);
                            removeFileContext();
                            addMessage(t.fileReadError(file.name), false);
                        }
                    };
                    reader.readAsArrayBuffer(file);
                } else {
                    // This block is now correctly triggered for unsupported files
                    removeFileContext();
                    addMessage(t.fileReadError(file.name), false);
                }
            } catch (error) {
                console.error('Error handling file:', error);
                removeFileContext();
                addMessage(t.fileReadError(file.name), false);
            } finally {
                sendButton.disabled = false;
            }
        }
        // --- END: New functions for file handling ---
        // START: NEW functions for image handling
        function removeImagePreview() {
            imageB64Data = null;
            imageUploadInput.value = '';
            imagePreviewContainer.style.display = 'none';
            addMessage("üñºÔ∏è Image removed from context.", false);
        }

        function handleImageSelect(event) {
            const file = event.target.files[0];
            if (!file) return;

            // Disable document upload if an image is selected
            if (fileContextContent) {
                removeFileContext();
            }

            const lang = document.getElementById('languageSelect').value;
            const fileSize = (file.size / 1024 / 1024).toFixed(2);

            if (fileSize > 4) { // 4MB limit for Gemini
                addMessage(translations[lang].fileTooLarge(fileSize), false);
                imageUploadInput.value = '';
                return;
            }

            const reader = new FileReader();
            reader.onload = (e) => {
                const fullB64String = e.target.result;
                imageThumbnail.src = fullB64String;
                imageInfo.textContent = file.name;
                imageB64Data = fullB64String.split(',')[1]; // Store only the base64 data
                imagePreviewContainer.style.display = 'flex';
                addMessage(`üñºÔ∏è Image "${file.name}" loaded. Ask a question about it.`, false);
            };
            reader.readAsDataURL(file);
        }
        // END: NEW functions

        async function sendMessage() {
            const message = messageInput.value.trim();
            const language = document.getElementById('languageSelect').value;
            const t = translations[language];

            // Check if there is any input
            if (!message && !imageB64Data) {
                alert("Please enter a message or upload an image.");
                return;
            }
            // Check if bot is stopped
            if (botResponsesStopped) {
                addMessage("Bot responses are currently stopped.", false);
                return;
            }

            // Prepare UI for sending
            if (currentChatMode === 'text-to-text') {
                if (message) addMessage(message, true);
                else if (imageB64Data) addMessage("Analyzing image...", true);
            }
            updateQuestionCounter();
            messageInput.value = '';
            mainLoadingIndicator.classList.add('active');
            sendButton.disabled = true;
            micButton.disabled = true;

            // --- The new routing logic ---
            try {
                if (imageB64Data) {
                    await sendToGemini(message);
                } else {
                    await sendToPerplexity(message);
                }
            } catch (error) {
                console.error("A critical error occurred in the send process:", error);
                addMessage(`An unexpected error occurred: ${error.message}`, false);
            } finally {
                // Clean up UI after API call is complete
                mainLoadingIndicator.classList.remove('active');
                voiceLoadingIndicator.classList.remove('active');
                sendButton.disabled = false;
                micButton.disabled = false;
                messageInput.focus();
            }
        }
        // REPLACE your old sendToGemini function with this corrected version

        async function sendToGemini(message) {
            if (!API_CONFIG.gemini.key || API_CONFIG.gemini.key === 'YOUR_GEMINI_API_KEY') {
                addMessage("ERROR: Gemini API key is missing. Please add it in the script to use the image analysis feature.", false);
                console.warn("WARNING: Gemini API key is not configured. For this to work, get a key from Google AI Studio and add it to the API_CONFIG object in the script.");
                removeImagePreview(); // Clear the image since we can't process it
                return;
            }

            mainLoadingIndicator.classList.add('active');
            addMessage(message || "Analyzing image...", true);
            messageInput.value = '';

            const language = document.getElementById('languageSelect').value;
            let promptText = `You are Krishi Samadhan, an agricultural expert AI. Analyze this image and answer the user's question.`;
            // Add this line inside the sendToGemini function
            promptText += `\n\n[RESPONSE FORMAT]\nYour response MUST strictly follow this format: First, provide your step-by-step analysis of the image and reasoning process in small inside <thinking> XML tags. After the thinking block, provide the final answer inside <answer> XML tags.`;

            if (userLocation && userWeather) {
                promptText += `\n\nCONTEXT: The user is in ${userLocation.city}, ${userLocation.country}. The current weather is ${userWeather.temperature}¬∞C. Today's date is ${new Date().toLocaleDateString()}. Use this to provide localized advice.`;
            }
            
            promptText += `\n\nUSER'S QUESTION: ${message || 'Describe this image in detail from an agricultural perspective.'}`;
            promptText += `\n\nIMPORTANT: Your response MUST be entirely in ${translations[language].languageName}.`;

            const requestBody = {
                "contents": [{
                    "parts": [
                        { "text": promptText },
                        {
                            "inline_data": {
                                "mime_type": "image/jpeg",
                                "data": imageB64Data
                            }
                        }
                    ]
                }]
            };

            try {
                // --- THIS LINE IS THE ONLY CHANGE ---
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${API_CONFIG.gemini.key}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(requestBody)
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error.message || "Unknown API error");
                }

                const data = await response.json();
                const aiResponse = data.candidates[0].content.parts[0].text;
                addMessage(aiResponse, false);

                if (currentChatMode === 'speech-to-speech' && aiResponse) {
                    speak(aiResponse, language);
                }
            } catch (error) {
                console.error("Error with Gemini API:", error);
                addMessage(`Sorry, there was an error analyzing the image: ${error.message}`, false);
            } finally {
                mainLoadingIndicator.classList.remove('active');
                removeImagePreview(); // Always clear image after sending
            }
        }


        async function sendToPerplexity(message) {
            const language = document.getElementById('languageSelect').value;
            try {
                const model = document.getElementById('modelSelect').value;
                let systemPrompt = document.getElementById('systemPrompt').value.trim();
                // Add this line inside the sendToPerplexity function
                systemPrompt += `\n\n[RESPONSE FORMAT]\nYour response MUST strictly follow this format: First, provide a step-by-step thinking process, analysis, and sources you are considering inside <thinking> XML tags. After the thinking block, provide the final, user-facing answer inside <answer> XML tags.`;

                if (userLocation && userWeather) {
                    systemPrompt += `\n\n[User's Context]\nThe user is in ${userLocation.city}, ${userLocation.country}. Current weather: ${userWeather.temperature}¬∞C with ${userWeather.windspeed} km/h winds. Today's date is ${new Date().toLocaleDateString()}. Provide location- and weather-aware advice, especially for agricultural questions.`;
                }
                
                systemPrompt += ` Your response MUST be entirely in ${translations[language].languageName}. Do not use any other language. Ensure perfect grammar and natural flow in ${translations[language].languageName}.`;
                
                let finalUserMessage = message;
                if (fileContextContent) {
                    finalUserMessage = `Using the following document as context, please answer the user's question... \n\n--- DOCUMENT CONTEXT ---\n${fileContextContent}\n\n--- USER QUESTION ---\n${message}`;
                }

                const response = await fetch('https://api.perplexity.ai/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${API_CONFIG.perplexity.key}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        model: model,
                        messages: [
                            { role: "system", content: systemPrompt },
                            { role: "user", content: finalUserMessage }
                        ],
                        max_tokens: 1000,
                        temperature: 0.7
                    })
                });

                if (!response.ok) {
                    const errorData = await response.text();
                    throw new Error(`HTTP ${response.status}: ${errorData}`);
                }

                const data = await response.json();
                const aiResponse = data.choices[0].message.content;
                addMessage(aiResponse, false);

                if (currentChatMode === 'speech-to-speech' && aiResponse.trim().length > 0) {
                    speak(aiResponse, language);
                }
            } catch (error) {
                console.error('Error in sendToPerplexity function:', error);
                let errorMessage = `Error: ${error.message}`;
                if (error.message.includes('401')) { errorMessage = "Invalid API key for Perplexity. Please check your settings."; }
                // ... (add other specific error messages if needed)
                addMessage(errorMessage, false);
                if (currentChatMode === 'speech-to-speech') {
                    speak(errorMessage, language);
                }
            }
        }

        function handleKeyPress(event) {
            if (event.key === 'Enter' && currentChatMode === 'text-to-text') {
                sendMessage();
            }
        }

        micButton.addEventListener('click', function() {
            if (currentChatMode === 'speech-to-speech') {
                voiceDialog.style.display = 'flex';
                const lang = document.getElementById('languageSelect').value;
                document.getElementById('voiceStatus').textContent = translations[lang].voiceStatusStart;
                resetTranscription();
                if (!botResponsesStopped) {
                    azureSpeechRecognizer.startRecognition();
                } else {
                    voiceStatus.textContent = `Bot responses are ${translations[lang].stopBotResponses.includes('Stop') ? 'stopped' : '‡§∞‡•ã‡§ï‡•á ‡§ó‡§è'}. Listening disabled.`;
                }
            }
        });

        // Add this new event listener for the Profit button
        profitButton.addEventListener('click', () => {
            // IMPORTANT: Replace this with the actual URL you want to link to
            const profitSiteUrl = "https://krishisamadhan.streamlit.app/"; 
            window.open(profitSiteUrl, '_blank'); // '_blank' opens the link in a new tab
        });

        closeDialog.addEventListener('click', function() {
            voiceDialog.style.display = 'none';
            finalTranscriptText = '';
            resetTranscription();
            if (azureSpeechRecognizer.recognizer && azureSpeechRecognizer.isListening) {
                azureSpeechRecognizer.stopRecognition();
            }
            stopSpeech();
        });

        // START: NEW Event Listeners for the Image Choice Modal
        closeImageChoiceModal.addEventListener('click', () => {
            imageChoiceModal.style.display = 'none';
        });

        takePictureButton.addEventListener('click', () => {
            imageUploadInput.setAttribute('capture', 'environment'); // Tell browser to prefer camera
            imageUploadInput.click();
            imageChoiceModal.style.display = 'none';
        });

        uploadPictureButton.addEventListener('click', () => {
            imageUploadInput.removeAttribute('capture'); // Allow normal file selection
            imageUploadInput.click();
            imageChoiceModal.style.display = 'none';
        });
        // END: NEW Event Listeners
        startListening.addEventListener('click', function() {
            if (!botResponsesStopped) {
                azureSpeechRecognizer.startRecognition();
            } else {
                const lang = document.getElementById('languageSelect').value;
                voiceStatus.textContent = `Bot responses are ${translations[lang].stopBotResponses.includes('Stop') ? 'stopped' : '‡§∞‡•ã‡§ï‡•á ‡§ó‡§è'}. Cannot start listening.`;
            }
        });
        // START: NEW Event Listeners
        // REPLACE the old cameraButton event listener with this one

        cameraButton.addEventListener('click', () => {
            imageChoiceModal.style.display = 'flex';
        });
        imageUploadInput.addEventListener('change', handleImageSelect);
        removeImageButton.addEventListener('click', removeImagePreview);
        // END: NEW Event Listeners

        stopListening.addEventListener('click', function() {
            azureSpeechRecognizer.stopRecognition();
        });

        sendVoiceMessage.addEventListener('click', function() {
            const transcriptText = transcription.textContent.trim();
            const lang = document.getElementById('languageSelect').value;
            
            if (transcriptText && 
                transcriptText !== translations[lang].transcriptionPlaceholder) {
                messageInput.value = transcriptText;
                voiceDialog.style.display = 'none';
                sendMessage();
                
                finalTranscriptText = '';
                resetTranscription();
            }
        });

        stopBotResponseButtonDialog.addEventListener('click', stopSpeech);

        document.getElementById('languageSelect').addEventListener('change', function() {
            updateInterface(this.value);
            saveSettings();
        });

        document.getElementById('modelSelect').addEventListener('change', function() {
            const modelInfo = document.getElementById('modelInfo');
            const lang = document.getElementById('languageSelect').value;
            const currentModel = this.value;
            const modelDescriptionInLang = translations[lang].modelDescriptions ? translations[lang].modelDescriptions[currentModel] : modelDescriptions[currentModel];
            modelInfo.textContent = modelDescriptionInLang;
            saveSettings();
        });

        // --- START: Event listeners for new file upload elements ---
        fileUploadButton.addEventListener('click', () => fileUploadInput.click());
        fileUploadInput.addEventListener('change', handleFileSelect);
        removeFileButton.addEventListener('click', removeFileContext);
        // --- END: Event listeners for new file upload elements ---

        document.addEventListener('DOMContentLoaded', async function() {
            loadSettings();
            loadQuestionStats();

            getLocationAndWeather();
            
            if (typeof SpeechSDK === 'undefined') {
                console.error('Azure Speech SDK not loaded');
                document.getElementById('voiceStatus').textContent = 'Azure Speech SDK not loaded. Voice input and output disabled.';
                micButton.disabled = true;
                startListening.disabled = true;
                stopListening.disabled = true;
                sendVoiceMessage.disabled = true;
                stopBotResponseButtonDialog.disabled = true;
                stopBotToggle.disabled = true;
            } else {
                initializeAzureSynthesizer();
                micButton.disabled = false;
            }
        });
    </script>
</body>
</html>
